{"version":3,"file":"form.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/views/formview.js","../../../apps/frappe/frappe/public/js/legacy/form.js","../../../apps/frappe/frappe/public/js/legacy/client_script_helpers.js","../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js","../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js","../../../apps/frappe/frappe/public/js/frappe/form/document_flow.js","../../../apps/frappe/frappe/public/js/frappe/form/save.js","../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js","../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js","../../../apps/frappe/frappe/public/js/frappe/form/workflow.js","../../../apps/frappe/frappe/public/js/frappe/form/print.js","../../../apps/frappe/frappe/public/js/frappe/form/form_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/form/user_image.js","../../../apps/frappe/frappe/public/js/frappe/form/share.js","../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/attachments.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/timeline.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/assign_to.js","../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js","../../../apps/frappe/frappe/public/js/frappe/form/success_action.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar me = this,\n\t\t\tdt = route[1];\n\n\t\tif(!frappe.views.formview[dt]) {\n\t\t\tfrappe.model.with_doctype(dt, function() {\n\t\t\t\tme.page = frappe.container.add_page(\"Form/\" + dt);\n\t\t\t\tfrappe.views.formview[dt] = me.page;\n\t\t\t\tme.page.frm = new _f.Frm(dt, me.page, true);\n\t\t\t\tme.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tme.show_doc(route);\n\t\t}\n\n\n\t\tif(!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"new_communication\", function(data) {\n\t\t\t\tfrappe.timeline.new_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"delete_communication\", function(data) {\n\t\t\t\tfrappe.timeline.delete_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on('update_communication', function(data) {\n\t\t\t\tfrappe.timeline.update_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\tfrappe.ui.form.set_viewers(data);\n\t\t\t});\n\t\t}\n\n\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar dt = route[1],\n\t\t\tdn = route.slice(2).join(\"/\"),\n\t\t\tme = this;\n\n\t\tif(frappe.model.new_names[dn]) {\n\t\t\tdn = frappe.model.new_names[dn];\n\t\t\tfrappe.set_route(\"Form\", dt, dn);\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.with_doc(dt, dn, function(dn, r) {\n\t\t\tif(r && r['403']) return; // not permitted\n\n\t\t\tif(!(locals[dt] && locals[dt][dn])) {\n\t\t\t\t// doc not found, but starts with New,\n\t\t\t\t// make a new doc and set it\n\t\t\t\tvar new_str = __(\"New\") + \" \";\n\t\t\t\tif(dn && dn.substr(0, new_str.length)==new_str) {\n\t\t\t\t\tvar new_name = frappe.model.make_new_doc_and_get_name(dt, true);\n\t\t\t\t\tif(new_name===dn) {\n\t\t\t\t\t\tme.load(dt, dn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", dt, new_name)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found(route);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.load(dt, dn);\n\t\t});\n\t}\n\n\tload(dt, dn) {\n\t\tfrappe.container.change_to(\"Form/\" + dt);\n\t\tfrappe.views.formview[dt].frm.refresh(dn);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/* Form page structure\n\n\t+ this.parent (either FormContainer or Dialog)\n\t\t+ this.wrapper\n\t\t\t+ this.toolbar\n\t\t\t+ this.form_wrapper\n\t\t\t\t\t+ this.head\n\t\t\t\t\t+ this.body\n\t\t\t\t\t\t+ this.layout\n\t\t\t\t+ this.sidebar\n\t\t\t+ this.footer\n*/\n\n/* eslint-disable no-console */\n\nfrappe.provide('_f');\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.Controller = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t}\n});\n\n_f.frms = {};\n\n_f.Frm = function(doctype, parent, in_form) {\n\tthis.docname = '';\n\tthis.doctype = doctype;\n\tthis.hidden = false;\n\tthis.refresh_if_stale_for = 120;\n\n\tvar me = this;\n\tthis.opendocs = {};\n\tthis.custom_buttons = {};\n\tthis.sections = [];\n\tthis.grids = [];\n\tthis.cscript = new frappe.ui.form.Controller({frm:this});\n\tthis.events = {};\n\tthis.pformat = {};\n\tthis.fetch_dict = {};\n\tthis.parent = parent;\n\tthis.tinymce_id_list = [];\n\n\tthis.setup_meta(doctype);\n\n\t// show in form instead of in dialog, when called using url (router.js)\n\tthis.in_form = in_form ? true : false;\n\n\t// notify on rename\n\t$(document).on('rename', function(event, dt, old_name, new_name) {\n\t\tif(dt==me.doctype)\n\t\t\tme.rename_notify(dt, old_name, new_name);\n\t});\n};\n\n_f.Frm.prototype.check_doctype_conflict = function(docname) {\n\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t} else if(this.doctype=='DocType') {\n\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t} else {\n\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.setup = function() {\n\tthis.fields = [];\n\tthis.fields_dict = {};\n\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t// wrapper\n\tthis.wrapper = this.parent;\n\tthis.$wrapper = $(this.wrapper);\n\tfrappe.ui.make_app_page({\n\t\tparent: this.wrapper,\n\t\tsingle_column: this.meta.hide_toolbar\n\t});\n\tthis.page = this.wrapper.page;\n\tthis.layout_main = this.page.main.get(0);\n\n\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\tfrm: this,\n\t\tpage: this.page\n\t});\n\n\t// print layout\n\tthis.setup_print_layout();\n\n\t// 2 column layout\n\tthis.setup_std_layout();\n\n\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\tfrm: this\n\t});\n\tthis.script_manager.setup();\n\tthis.watch_model_updates();\n\n\tif(!this.meta.hide_toolbar) {\n\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t});\n\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t}\n\tthis.setup_drag_drop();\n\n\tthis.setup_done = true;\n};\n\n_f.Frm.prototype.setup_drag_drop = function() {\n\tvar me = this;\n\tthis.$wrapper.on('dragenter dragover', false)\n\t\t.on('drop', function(e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif(me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tif(me.attachments.max_reached()) {\n\t\t\t\tfrappe.msgprint(__(\"Maximum Attachment Limit for this record reached.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tfrappe.upload.make({\n\t\t\t\targs: me.attachments.get_args(),\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tcallback: function(attachment, r) {\n\t\t\t\t\tme.attachments.attachment_uploaded(attachment, r);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n};\n\n_f.Frm.prototype.setup_print_layout = function() {\n\tvar me = this;\n\tthis.print_preview = new frappe.ui.form.PrintPreview({\n\t\tfrm: this\n\t});\n\n\t// show edit button for print view\n\tthis.page.wrapper.on('view-change', function() {\n\t\tme.toolbar.set_primary_action();\n\t});\n};\n\n_f.Frm.prototype.print_doc = function() {\n\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\tthis.hide_print();\n\t\treturn;\n\t}\n\tif(!frappe.model.can_print(this.doc.doctype, this)) {\n\t\tfrappe.msgprint(__(\"You are not allowed to print this document\"));\n\t\treturn;\n\t}\n\n\tthis.print_preview.refresh_print_options().trigger(\"change\");\n\tthis.page.set_view(\"print\");\n\tthis.print_preview.set_user_lang();\n\tthis.print_preview.set_default_print_language();\n\tthis.print_preview.preview();\n};\n\n_f.Frm.prototype.hide_print = function() {\n\tif(this.setup_done && this.page.current_view_name===\"print\") {\n\t\tthis.page.set_view(this.page.previous_view_name===\"print\" ?\n\t\t\t\"main\" : (this.page.previous_view_name || \"main\"));\n\t}\n};\n\n_f.Frm.prototype.watch_model_updates = function() {\n\t// watch model updates\n\tvar me = this;\n\n\t// on main doc\n\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc) {\n\t\t// set input\n\t\tif(doc.name===me.docname) {\n\t\t\tif ((value==='' || value===null) && !doc[fieldname]) {\n\t\t\t\t// both the incoming and outgoing values are falsy\n\t\t\t\t// the texteditor, summernote, changes nulls to empty strings on render,\n\t\t\t\t// so ignore those changes\n\t\t\t} else {\n\t\t\t\tme.dirty();\n\t\t\t}\n\t\t\tlet field = me.fields_dict[fieldname];\n\t\t\tfield && field.refresh(fieldname);\n\n\t\t\t// Validate value for link field explicitly\n\t\t\tfield && [\"Link\", \"Dynamic Link\"].includes(field.df.fieldtype) && field.validate && field.validate(value);\n\n\t\t\tme.layout.refresh_dependency();\n\t\t\tlet object = me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\treturn object;\n\t\t}\n\t});\n\n\t// on table fields\n\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {fieldtype:\"Table\"});\n\n\t// using $.each to preserve df via closure\n\t$.each(table_fields, function(i, df) {\n\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\tif(doc.parent===me.docname && doc.parentfield===df.fieldname) {\n\t\t\t\tme.dirty();\n\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\tme.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\t});\n};\n\n_f.Frm.prototype.setup_std_layout = function() {\n\tthis.form_wrapper \t= $('<div></div>').appendTo(this.layout_main);\n\tthis.body \t\t\t= $('<div></div>').appendTo(this.form_wrapper);\n\n\t// only tray\n\tthis.meta.section_style='Simple'; // always simple!\n\n\t// layout\n\tthis.layout = new frappe.ui.form.Layout({\n\t\tparent: this.body,\n\t\tdoctype: this.doctype,\n\t\tfrm: this,\n\t\twith_dashboard: true\n\t});\n\tthis.layout.make();\n\n\tthis.fields_dict = this.layout.fields_dict;\n\tthis.fields = this.layout.fields_list;\n\n\tthis.document_flow = new frappe.ui.form.DocumentFlow({\n\t\tfrm: this\n\t});\n\n\tthis.dashboard = new frappe.ui.form.Dashboard({\n\t\tfrm: this,\n\t});\n\n\t// state\n\tthis.states = new frappe.ui.form.States({\n\t\tfrm: this\n\t});\n};\n\n// email the form\n_f.Frm.prototype.email_doc = function(message) {\n\tnew frappe.views.CommunicationComposer({\n\t\tdoc: this.doc,\n\t\tfrm: this,\n\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\tattach_document_print: true,\n\t\tmessage: message,\n\t\treal_name: this.doc.real_name || this.doc.contact_display || this.doc.contact_name\n\t});\n};\n\n// rename the form\n_f.Frm.prototype.rename_doc = function() {\n\tfrappe.model.rename_doc(this.doctype, this.docname);\n};\n\n_f.Frm.prototype.share_doc = function() {\n\tthis.shared.show();\n};\n\n// notify this form of renamed records\n_f.Frm.prototype.rename_notify = function(dt, old, name) {\n\t// from form\n\tif(this.meta.istable)\n\t\treturn;\n\n\tif(this.docname == old)\n\t\tthis.docname = name;\n\telse\n\t\treturn;\n\n\t// cleanup\n\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t// delete docfield copy\n\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t}\n\n\tdelete this.opendocs[old];\n\tthis.opendocs[name] = true;\n\n\tif(this.meta.in_dialog || !this.in_form) {\n\t\treturn;\n\t}\n\n\tfrappe.re_route[window.location.hash] = '#Form/' + encodeURIComponent(this.doctype) + '/' + encodeURIComponent(name);\n\tfrappe.set_route('Form', this.doctype, name);\n};\n\n// SETUP\n\n_f.Frm.prototype.setup_meta = function() {\n\tthis.meta = frappe.get_doc('DocType', this.doctype);\n\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\tif(this.meta.istable) {\n\t\tthis.meta.in_dialog = 1;\n\t}\n};\n\n_f.Frm.prototype.refresh_header = function(is_a_different_doc) {\n\t// set title\n\t// main title\n\tif(!this.meta.in_dialog || this.in_form) {\n\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t}\n\n\t// show / hide buttons\n\tif(this.toolbar) {\n\t\tif (is_a_different_doc) {\n\t\t\tthis.toolbar.current_status = undefined;\n\t\t}\n\n\t\tthis.toolbar.refresh();\n\t}\n\n\tthis.document_flow.refresh();\n\tthis.dashboard.refresh();\n\n\tif(this.meta.is_submittable\n\t\t&& this.perm[0] && this.perm[0].submit\n\t\t&& !this.is_dirty()\n\t\t&& !this.is_new()\n\t\t&& !frappe.model.has_workflow(this.doctype) // show only if no workflow\n\t\t&& this.doc.docstatus===0) {\n\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'orange', true);\n\t}\n\n\tthis.clear_custom_buttons();\n\n\tthis.show_web_link();\n};\n\n_f.Frm.prototype.show_web_link = function() {\n\tvar doc = this.doc, me = this;\n\tif(!doc.__islocal && doc.__onload && doc.__onload.is_website_generator) {\n\t\tme.web_link && me.web_link.remove();\n\t\tif(doc.__onload.published) {\n\t\t\tme.add_web_link(\"/\" + doc.route);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.add_web_link = function(path, label) {\n\tlabel = label || \"See on Website\";\n\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n};\n\n_f.Frm.prototype.check_doc_perm = function() {\n\t// get perm\n\tvar dt = this.parent_doctype?this.parent_doctype : this.doctype;\n\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\tif(!this.perm[0].read) {\n\t\treturn 0;\n\t}\n\treturn 1;\n};\n\n_f.Frm.prototype.refresh = function(docname) {\n\tvar is_a_different_doc = docname ? true : false;\n\n\tif(docname) {\n\t\t// record switch\n\t\tif(this.docname != docname && (!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\t\tfrappe.utils.scroll_to(0);\n\t\t\tthis.hide_print();\n\t\t}\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => grid_obj.grid.visible_columns = null);\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.docname = docname;\n\t}\n\n\tcur_frm = this;\n\n\tif(this.docname) { // document to show\n\n\t\t// set the doc\n\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t// check permissions\n\t\tif(!this.check_doc_perm()) {\n\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(this.docname));\n\t\t\treturn;\n\t\t}\n\n\t\t// read only (workflow)\n\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t// check if doctype is already open\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t} else {\n\t\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\t\tthis.reload_doc();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// do setup\n\t\tif(!this.setup_done) {\n\t\t\tthis.setup();\n\t\t}\n\n\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.setnewdoc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function() {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(is_a_different_doc);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\n\t\t// if print format is shown, refresh the format\n\t\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\tthis.print_preview.preview();\n\t\t}\n\n\t\tif(is_a_different_doc) {\n\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t// show print view\n\t\t\t\tthis.print_doc();\n\t\t\t}\n\t\t}\n\n\t\t// set status classes\n\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\tthis.show_if_needs_refresh();\n\t}\n};\n\n_f.Frm.prototype.show_if_needs_refresh = function() {\n\tif(this.doc.__needs_refresh) {\n\t\tif(this.doc.__unsaved) {\n\t\t\tthis.dashboard.clear_headline();\n\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t+ '<a class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t+ __(\"Refresh\") + '</a>', \"alert-warning\");\n\t\t} else {\n\t\t\tthis.reload_doc();\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.render_form = function(is_a_different_doc) {\n\tif(!this.meta.istable) {\n\t\tthis.layout.doc = this.doc;\n\t\tthis.layout.attach_doc_and_docfields();\n\n\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\t\tthis.sidebar.make();\n\n\t\t// clear layout message\n\t\tthis.layout.show_message();\n\n\t\tfrappe.run_serially([\n\t\t\t// header must be refreshed before client methods\n\t\t\t// because add_custom_button\n\t\t\t() => this.refresh_header(is_a_different_doc),\n\t\t\t// trigger global trigger\n\t\t\t// to use this\n\t\t\t() => $(document).trigger('form-refresh', [this]),\n\t\t\t// fields\n\t\t\t() => this.refresh_fields(),\n\t\t\t// call trigger\n\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t// call onload post render for callbacks to be fired\n\t\t\t() => {\n\t\t\t\tif(this.cscript.is_onload) {\n\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => this.dashboard.after_refresh()\n\t\t]);\n\t\t// focus on first input\n\n\t\tif(this.is_new()) {\n\t\t\tvar first = this.form_wrapper.find('.form-layout input:first');\n\t\t\tif(!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\tfirst.focus();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.refresh_header(is_a_different_doc);\n\t}\n\n\tthis.$wrapper.trigger('render_complete');\n\n\tif(!this.hidden) {\n\t\tthis.layout.show_empty_form_message();\n\t}\n\n\tthis.scroll_to_element();\n};\n\n_f.Frm.prototype.refresh_field = function(fname) {\n\tif(this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\tthis.fields_dict[fname].refresh();\n\t\tthis.layout.refresh_dependency();\n\t}\n};\n\n_f.Frm.prototype.refresh_fields = function() {\n\tthis.layout.refresh(this.doc);\n\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t// cleanup activities after refresh\n\tthis.cleanup_refresh(this);\n};\n\n\n_f.Frm.prototype.cleanup_refresh = function() {\n\tvar me = this;\n\tif(me.fields_dict['amended_from']) {\n\t\tif (me.doc.amended_from) {\n\t\t\tunhide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t} else {\n\t\t\thide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t}\n\t}\n\n\tif(me.fields_dict['trash_reason']) {\n\t\tif(me.doc.trash_reason && me.doc.docstatus == 2) {\n\t\t\tunhide_field('trash_reason');\n\t\t} else {\n\t\t\thide_field('trash_reason');\n\t\t}\n\t}\n\n\tif(me.meta.autoname && me.meta.autoname.substr(0,6)=='field:' && !me.doc.__islocal) {\n\t\tvar fn = me.meta.autoname.substr(6);\n\n\t\tif (me.doc[fn]) {\n\t\t\tme.toggle_display(fn, false);\n\t\t}\n\t}\n\n\tif(me.meta.autoname==\"naming_series:\" && !me.doc.__islocal) {\n\t\tme.toggle_display(\"naming_series\", false);\n\t}\n};\n\n_f.Frm.prototype.setnewdoc = function() {\n\t// moved this call to refresh function\n\t// this.check_doctype_conflict(docname);\n\tvar me = this;\n\n\t// hide any open grid\n\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t.then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function() {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t// update seen\n\tif(this.meta.track_seen) {\n\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t}\n};\n\n_f.Frm.prototype.trigger_link_fields = function() {\n\t// trigger link fields which have default values set\n\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\tif (in_list(['Link', 'Dynamic Link'], field.df.fieldtype) && this.doc[fieldname]) {\n\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\tfield.set_value(this.doc[fieldname]);\n\t\t\t}\n\t\t});\n\n\t\tdelete this.doc.__run_link_triggers;\n\t}\n};\n\n_f.Frm.prototype.runscript = function(scriptname, callingfield, onrefresh) {\n\tvar me = this;\n\tif(this.docname) {\n\t\t// send to run\n\t\tif(callingfield)\n\t\t\t$(callingfield.input).set_working();\n\n\t\tfrappe.call({\n\t\t\tmethod: \"runserverobj\",\n\t\t\targs: {'docs':this.doc, 'method':scriptname },\n\t\t\tbtn: callingfield.$input,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(onrefresh) {\n\t\t\t\t\t\tonrefresh(r);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.copy_doc = function(onload, from_amend) {\n\tthis.validate_form_action(\"Create\");\n\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\tnewdoc.idx = null;\n\tnewdoc.__run_link_triggers = false;\n\tif(onload) {\n\t\tonload(newdoc);\n\t}\n\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n};\n\n_f.Frm.prototype.reload_doc = function() {\n\tthis.check_doctype_conflict(this.docname);\n\n\tvar me = this;\n\n\tif(!me.doc.__islocal) {\n\t\tfrappe.model.remove_from_locals(me.doctype, me.docname);\n\t\tfrappe.model.with_doc(me.doctype, me.docname, function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n\n_f.Frm.prototype.save = function(save_action, callback, btn, on_error) {\n\tlet me = this;\n\treturn new Promise((resolve, reject) => {\n\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t$(document.activeElement).blur();\n\n\t\tfrappe.ui.form.close_grid_form();\n\t\t// let any pending js process finish\n\t\tsetTimeout(function() {\n\t\t\tme._save(save_action, callback, btn, on_error, resolve, reject);\n\t\t}, 100);\n\t}).then(() => {\n\t\tme.show_success_action();\n\t}).catch((e) => {\n\t\tconsole.error(e);\n\t});\n};\n\n_f.Frm.prototype._save = function(save_action, callback, btn, on_error, resolve, reject) {\n\tvar me = this;\n\tif(!save_action) save_action = \"Save\";\n\tthis.validate_form_action(save_action, resolve);\n\n\tif((!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\tfrappe.utils.scroll_to(0);\n\t}\n\tvar after_save = function(r) {\n\t\tif (!r.exc) {\n\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action) !== -1) {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t}\n\n\t\t\tme.script_manager.trigger(\"after_save\");\n\t\t\t// submit comment if entered\n\n\t\t\tif (me.timeline) {\n\t\t\t\tme.timeline.comment_area.submit();\n\t\t\t}\n\t\t\tme.refresh();\n\t\t} else {\n\t\t\tif (on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t}\n\n\t\tcallback && callback(r);\n\t\tresolve();\n\t};\n\n\tvar fail = () => {\n\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\tif(on_error) {\n\t\t\ton_error();\n\t\t\treject();\n\t\t}\n\t};\n\n\tif(save_action != \"Update\") {\n\t\t// validate\n\t\tfrappe.validated = true;\n\t\tfrappe.run_serially([\n\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t() => {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\tfail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t}\n\t\t]).catch(fail);\n\t} else {\n\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t}\n};\n\n\n_f.Frm.prototype.savesubmit = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\treturn new Promise(resolve => {\n\t\tthis.validate_form_action(\"Submit\");\n\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\thandle_fail();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t\t}\n\t\t\t\t}, btn, () => handle_fail(), resolve);\n\t\t\t});\n\t\t}, () => handle_fail() );\n\t});\n};\n\n_f.Frm.prototype.savecancel = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\tthis.validate_form_action('Cancel');\n\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), function() {\n\t\tfrappe.validated = true;\n\t\tme.script_manager.trigger(\"before_cancel\").then(function() {\n\t\t\tif(!frappe.validated) {\n\t\t\t\thandle_fail();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar after_cancel = function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t});\n\t}, () => handle_fail());\n};\n\n// delete the record\n_f.Frm.prototype.savetrash = function() {\n\tthis.validate_form_action(\"Delete\");\n\tfrappe.model.delete_doc(this.doctype, this.docname, function() {\n\t\twindow.history.back();\n\t});\n};\n\n_f.Frm.prototype.amend_doc = function() {\n\tif(!this.fields_dict['amended_from']) {\n\t\talert('\"amended_from\" field must be present to do an amendment.');\n\t\treturn;\n\t}\n\tthis.validate_form_action(\"Amend\");\n\tvar me = this;\n\tvar fn = function(newdoc) {\n\t\tnewdoc.amended_from = me.docname;\n\t\tif(me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t};\n\tthis.copy_doc(fn, 1);\n\tfrappe.utils.play_sound(\"click\");\n};\n\n_f.Frm.prototype.disable_save = function() {\n\t// IMPORTANT: this function should be called in refresh event\n\tthis.save_disabled = true;\n\tthis.toolbar.current_status = null;\n\tthis.page.clear_primary_action();\n};\n\n_f.Frm.prototype.enable_save = function() {\n\tthis.save_disabled = false;\n\tthis.toolbar.set_primary_action();\n};\n\n_f.Frm.prototype.save_or_update = function() {\n\tif(this.save_disabled) return;\n\n\tif(this.doc.docstatus===0) {\n\t\tthis.save();\n\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\tthis.save(\"Update\");\n\t}\n};\n\n_f.Frm.prototype.dirty = function() {\n\tthis.doc.__unsaved = 1;\n\tthis.$wrapper.trigger('dirty');\n};\n\n_f.Frm.prototype.get_docinfo = function() {\n\treturn frappe.model.docinfo[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.is_dirty = function() {\n\treturn this.doc.__unsaved;\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n\n_f.Frm.prototype.reload_docinfo = function(callback) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\targs: {\n\t\t\tdoctype: me.doctype,\n\t\t\tname: me.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// docinfo will be synced\n\t\t\tif(callback) callback(r.docinfo);\n\t\t\tme.timeline.refresh();\n\t\t\tme.assign_to.refresh();\n\t\t\tme.attachments.refresh();\n\t\t}\n\t});\n};\n\n\n_f.Frm.prototype.get_perm = function(permlevel, access_type) {\n\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n};\n\n\n_f.Frm.prototype.set_intro = function(txt) {\n\tthis.dashboard.set_headline_alert(txt);\n};\n\n_f.Frm.prototype.set_footnote = function(txt) {\n\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n};\n\n\n_f.Frm.prototype.add_custom_button = function(label, fn, group) {\n\t// temp! old parameter used to be icon\n\tif(group && group.indexOf(\"fa fa-\")!==-1) group = null;\n\tvar btn = this.page.add_inner_button(label, fn, group);\n\tif(btn) {\n\t\tthis.custom_buttons[label] = btn;\n\t}\n\treturn btn;\n};\n\n//Remove all custom buttons\n_f.Frm.prototype.clear_custom_buttons = function() {\n\tthis.page.clear_inner_toolbar();\n\tthis.page.clear_user_actions();\n\tthis.custom_buttons = {};\n};\n\n//Remove specific custom button by button Label\n_f.Frm.prototype.remove_custom_button = function(label, group) {\n\tthis.page.remove_inner_button(label, group);\n};\n\n_f.Frm.prototype.add_fetch = function(link_field, src_field, tar_field) {\n\tif(!this.fetch_dict[link_field]) {\n\t\tthis.fetch_dict[link_field] = {'columns':[], 'fields':[]};\n\t}\n\tthis.fetch_dict[link_field].columns.push(src_field);\n\tthis.fetch_dict[link_field].fields.push(tar_field);\n};\n\n_f.Frm.prototype.set_print_heading = function(txt) {\n\tthis.pformat[this.docname] = txt;\n};\n\n_f.Frm.prototype.action_perm_type_map = {\n\t\"Create\": \"create\",\n\t\"Save\": \"write\",\n\t\"Submit\": \"submit\",\n\t\"Update\": \"submit\",\n\t\"Cancel\": \"cancel\",\n\t\"Amend\": \"amend\",\n\t\"Delete\": \"delete\"\n};\n\n_f.Frm.prototype.validate_form_action = function(action, resolve) {\n\tvar perm_to_check = this.action_perm_type_map[action];\n\tvar allowed_for_workflow = false;\n\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t// workflows if the user already have those permissions. This is to allow for users to\n\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\tallowed_for_workflow = true;\n\t}\n\n\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\tif(resolve) {\n\t\t\t// re-enable buttons\n\t\t\tresolve();\n\t\t}\n\t\tfrappe.throw (__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)]));\n\t}\n};\n\n_f.Frm.prototype.has_perm = function(ptype) {\n\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n};\n\n_f.Frm.prototype.scroll_to_element = function() {\n\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\tdelete frappe.route_options.scroll_to;\n\n\t\tvar selector = [];\n\t\tfor (var key in scroll_to) {\n\t\t\tvar value = scroll_to[key];\n\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t}\n\n\t\tselector = $(selector.join(\" \"));\n\t\tif (selector.length) {\n\t\t\tfrappe.utils.scroll_to(selector);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.show_success_action = function() {\n\tconst route = frappe.get_route();\n\tif (route[0] !== 'Form') return;\n\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\tsuccess_action.show();\n};\n\n_f.Frm.prototype.is_first_creation = function() {\n\tlet { modified, creation } = this.doc;\n\n\t// strip out milliseconds\n\tmodified = modified.split('.')[0];\n\tcreation = creation.split('.')[0];\n\n\treturn modified === creation;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.get_server_fields = function(method, arg, table_field, doc, dt, dn, allow_edit, call_back) {\n\tconsole.warn(\"This function 'get_server_fields' has been deprecated and will be removed soon.\");\n\tfrappe.dom.freeze();\n\tif($.isPlainObject(arg)) arg = JSON.stringify(arg);\n\treturn $c('runserverobj', {'method': method, 'docs': JSON.stringify(doc), 'arg': arg },\n\t\tfunction(r) {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (r.message)  {\n\t\t\t\tvar d = locals[dt][dn];\n\t\t\t\tvar field_dict = r.message;\n\t\t\t\tfor(var key in field_dict) {\n\t\t\t\t\td[key] = field_dict[key];\n\t\t\t\t\tif (table_field)\n\t\t\t\t\t\trefresh_field(key, d.name, table_field);\n\t\t\t\t\telse\n\t\t\t\t\t\trefresh_field(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(call_back){\n\t\t\t\tdoc = locals[doc.doctype][doc.name];\n\t\t\t\tcall_back(doc, dt, dn);\n\t\t\t}\n\t\t});\n};\n\n\nwindow.set_multiple = function(dt, dn, dict, table_field) {\n\tvar d = locals[dt][dn];\n\tfor(var key in dict) {\n\t\td[key] = dict[key];\n\t\tif (table_field)\n\t\t\trefresh_field(key, d.name, table_field);\n\t\telse\n\t\t\trefresh_field(key);\n\t}\n};\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.set_field_tip = function(n,txt) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df)df.description = txt;\n\n\tif(cur_frm && cur_frm.fields_dict) {\n\t\tif(cur_frm.fields_dict[n])\n\t\t\tcur_frm.fields_dict[n].comment_area.innerHTML = frappe.utils.replace_newlines(txt);\n\t\telse\n\t\t\tconsole.log('[set_field_tip] Unable to set field tip: ' + n);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field){\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n});\n\t\tif (field && field.length){\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (docname){\n\t\t\t\tcur_frm.fields_dict[table_field].grid.grid_rows_by_docname[docname].refresh_field(n);\n\t\t\t} else {\n\t\t\t\tcur_frm.fields_dict[table_field].grid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.set_field_permlevel = function(n, level) {\n\tcur_frm.set_df_property(n, 'permlevel', level);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n\nwindow.get_field_obj = function(fn) {\n\treturn cur_frm.fields_dict[fn];\n};\n\n_f.Frm.prototype.get_doc = function() {\n\treturn locals[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.set_currency_labels = function(fields_list, currency, parentfield) {\n\t// To set the currency in the label\n\t// For example Total Cost(INR), Total Cost(USD)\n\n\tvar me = this;\n\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\tvar field_label_map = {};\n\tvar grid_field_label_map = {};\n\n\t$.each(fields_list, function(i, fname) {\n\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\tif(docfield) {\n\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\tif(parentfield) {\n\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t} else {\n\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t}\n\t\t}\n\t});\n\n\t$.each(field_label_map, function(fname, label) {\n\t\tme.fields_dict[fname].set_label(label);\n\t});\n\n\t$.each(grid_field_label_map, function(fname, label) {\n\t\tfname = fname.split(\"-\");\n\t\tvar df = frappe.meta.get_docfield(fname[0], fname[1], me.doc.name);\n\t\tif(df) df.label = label;\n\t});\n};\n\n_f.Frm.prototype.field_map = function(fnames, fn) {\n\tif(typeof fnames==='string') {\n\t\tif(fnames == '*') {\n\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t} else {\n\t\t\tfnames = [fnames];\n\t\t}\n\t}\n\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\tvar fieldname = fnames[i];\n\t\tvar field = frappe.meta.get_docfield(cur_frm.doctype, fieldname, this.docname);\n\t\tif(field) {\n\t\t\tfn(field);\n\t\t\tthis.refresh_field(fieldname);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.get_docfield = function(fieldname1, fieldname2) {\n\tif(fieldname2) {\n\t\t// for child\n\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t} else {\n\t\t// for parent\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t}\n};\n\n_f.Frm.prototype.set_df_property = function(fieldname, property, value, docname, table_field) {\n\tvar df;\n\tif (!docname && !table_field){\n\t\tdf = this.get_docfield(fieldname);\n\t} else {\n\t\tvar grid = this.fields_dict[table_field].grid,\n\t\t\tfname = frappe.utils.filter_dict(grid.docfields, {'fieldname': fieldname});\n\t\tif (fname && fname.length)\n\t\t\tdf = frappe.meta.get_docfield(fname[0].parent, fieldname, docname);\n\t}\n\tif(df && df[property] != value) {\n\t\tdf[property] = value;\n\t\trefresh_field(fieldname, table_field);\n\t}\n};\n\n_f.Frm.prototype.toggle_enable = function(fnames, enable) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.read_only = enable ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.toggle_reqd = function(fnames, mandatory) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.reqd = mandatory ? true : false;\n\t});\n};\n\n_f.Frm.prototype.toggle_display = function(fnames, show) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.hidden = show ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.call_server = function(method, args, callback) {\n\treturn $c_obj(this.doc, method, args, callback);\n};\n\n_f.Frm.prototype.get_files = function() {\n\treturn this.attachments\n\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t: [] ;\n};\n\n_f.Frm.prototype.set_query = function(fieldname, opt1, opt2) {\n\tif(opt2) {\n\t\t// on child table\n\t\t// set_query(fieldname, parent fieldname, query)\n\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t} else {\n\t\t// on parent table\n\t\t// set_query(fieldname, query)\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.set_value_if_missing = function(field, value) {\n\treturn this.set_value(field, value, true);\n};\n\n_f.Frm.prototype.clear_table = function(fieldname) {\n\tfrappe.model.clear_table(this.doc, fieldname);\n};\n\n_f.Frm.prototype.add_child = function(fieldname, values) {\n\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\tif(values) {\n\t\t// Values of unique keys should not be overridden\n\t\tvar d = {};\n\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\tObject.keys(values).map((key) => {\n\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\td[key] = values[key];\n\t\t\t}\n\t\t});\n\n\t\t$.extend(doc, d);\n\t}\n\treturn doc;\n};\n\n_f.Frm.prototype.set_value = function(field, value, if_missing) {\n\tvar me = this;\n\tvar _set = function(f, v) {\n\t\tvar fieldobj = me.fields_dict[f];\n\t\tif(fieldobj) {\n\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\tif(fieldobj.df.fieldtype===\"Table\" && $.isArray(v)) {\n\n\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\tfor (var i=0, j=v.length; i < j; i++) {\n\t\t\t\t\t\tvar d = v[i];\n\t\t\t\t\t\tvar child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\tfieldobj.df.fieldname, i+1);\n\t\t\t\t\t\t$.extend(child, d);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\tthrow \"frm.set_value\";\n\t\t}\n\t};\n\n\tif(typeof field==\"string\") {\n\t\treturn _set(field, value);\n\t} else if($.isPlainObject(field)) {\n\t\tlet tasks = [];\n\t\tfor (let f in field) {\n\t\t\tlet v = field[f];\n\t\t\tif(me.get_field(f)) {\n\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t}\n\t\t}\n\t\treturn frappe.run_serially(tasks);\n\t}\n};\n\n_f.Frm.prototype.call = function(opts, args, callback) {\n\tvar me = this;\n\tif(typeof opts==='string') {\n\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\topts = {\n\t\t\tmethod: opts,\n\t\t\tdoc: this.doc,\n\t\t\targs: args,\n\t\t\tcallback: callback\n\t\t};\n\t}\n\tif(!opts.doc) {\n\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\tif(opts.child) {\n\t\t\t\t\t// update child doc\n\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\tvar std_field_list = [\"doctype\"].concat(frappe.model.std_fields_list);\n\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t} else {\n\t\t\t\t\t// update parent doc\n\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\t} else {\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\n\t}\n\treturn frappe.call(opts);\n};\n\n_f.Frm.prototype.get_field = function(field) {\n\treturn this.fields_dict[field];\n};\n\n\n_f.Frm.prototype.set_read_only = function() {\n\tvar perm = [];\n\tvar docperms = frappe.perm.get_perm(this.doc.doctype);\n\tfor (var i=0, l=docperms.length; i<l; i++) {\n\t\tvar p = docperms[i];\n\t\tperm[p.permlevel || 0] = {read:1, print:1, cancel:1, email:1};\n\t}\n\tthis.perm = perm;\n};\n\n_f.Frm.prototype.trigger = function(event) {\n\treturn this.script_manager.trigger(event);\n};\n\n_f.Frm.prototype.get_formatted = function(fieldname) {\n\treturn frappe.format(this.doc[fieldname],\n\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t{no_icon:true}, this.doc);\n};\n\n_f.Frm.prototype.open_grid_row = function() {\n\treturn frappe.ui.form.get_open_grid_form();\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n_f.Frm.prototype.get_title = function() {\n\tif(this.meta.title_field) {\n\t\treturn this.doc[this.meta.title_field];\n\t} else {\n\t\treturn this.doc.name;\n\t}\n};\n\n_f.Frm.prototype.get_selected = function() {\n\t// returns list of children that are selected. returns [parentfield, name] for each\n\tvar selected = {}, me = this;\n\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\tvar _selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\tif(_selected.length) {\n\t\t\tselected[df.fieldname] = _selected;\n\t\t}\n\t});\n\treturn selected;\n};\n\n_f.Frm.prototype.has_mapper = function() {\n\t// hackalert!\n\t// if open_mapped_doc is mentioned in the custom script, then mapper exists\n\tif(this._has_mapper === undefined) {\n\t\tthis._has_mapper = (this.meta.__js && this.meta.__js.search('open_mapped_doc')!==-1) ?\n\t\t\ttrue: false;\n\t}\n\treturn this._has_mapper;\n};\n\n_f.Frm.prototype.set_indicator_formatter = function(fieldname, get_color, get_text) {\n\t// get doctype from parent\n\tvar doctype;\n\tif(frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\tdoctype = this.doctype;\n\t} else {\n\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\tif(frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\tdoctype = df.options;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\tfunction(value, df, options, doc) {\n\t\t\tif(value) {\n\t\t\t\tvar label;\n\t\t\t\tif(get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if(frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\t\t\t\treturn repl('<a class=\"indicator %(color)s\" href=\"#Form/%(doctype)s/%(name)s\">%(label)s</a>', {\n\t\t\t\t\tcolor: get_color(doc || {}),\n\t\t\t\t\tdoctype: df.options,\n\t\t\t\t\tname: escaped_name,\n\t\t\t\t\tlabel: label\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n};\n\n_f.Frm.prototype.can_create = function(doctype) {\n\t// return true or false if the user can make a particlar doctype\n\t// will check permission, `can_make_methods` if exists, or will decided on\n\t// basis of whether the document is submittable\n\tif(!frappe.model.can_create(doctype)) {\n\t\treturn false;\n\t}\n\n\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t// custom buttons are translated and so are the keys\n\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t// if the button is present, then show make\n\t\treturn !!this.custom_buttons[key];\n\t}\n\n\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\treturn this.can_make_methods[doctype](this);\n\t} else {\n\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.make_new = function(doctype) {\n\t// make new doctype from the current form\n\t// will handover to `make_methods` if defined\n\t// or will create and match link fields\n\tvar me = this;\n\tif(this.make_methods && this.make_methods[doctype]) {\n\t\treturn this.make_methods[doctype](this);\n\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t} else {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\n\t\t\t// set link fields (if found)\n\t\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\t\tif(df.fieldtype==='Link' && df.options===me.doctype) {\n\t\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.update_in_all_rows = function(table_fieldname, fieldname, value) {\n\t// update the child value in all tables where it is missing\n\tif(!value) return;\n\tvar cl = this.doc[table_fieldname] || [];\n\tfor(var i = 0; i < cl.length; i++){\n\t\tif(!cl[i][fieldname]) cl[i][fieldname] = value;\n\t}\n\trefresh_field(\"items\");\n};\n\n_f.Frm.prototype.get_sum = function(table_fieldname, fieldname) {\n\tlet sum = 0;\n\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\tsum += d[fieldname];\n\t}\n\treturn sum;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Toolbar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t},\n\trefresh: function() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\tset_title: function() {\n\t\tif(this.frm.meta.title_field) {\n\t\t\tlet title_field = (this.frm.doc[this.frm.meta.title_field] || \"\").toString().trim();\n\t\t\tvar title = strip_html(title_field || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t},\n\tis_title_editable: function() {\n\t\tif (this.frm.meta.title_field===\"title\"\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.get_docfield(\"title\").options\n\t\t\t&& !this.frm.doc.__islocal) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tcan_rename: function() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t},\n\tsetup_editable_title: function() {\n\t\tvar me = this;\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", function() {\n\t\t\tif(me.is_title_editable()) {\n\t\t\t\tfrappe.prompt({fieldname: \"title\", fieldtype:\"Data\",\n\t\t\t\t\tlabel: __(\"Title\"), reqd: 1, \"default\": me.frm.doc.title },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.title) {\n\t\t\t\t\t\t\tme.frm.set_value(\"title\", data.title);\n\t\t\t\t\t\t\tif(!me.frm.doc.__islocal) {\n\t\t\t\t\t\t\t\tme.frm.save_or_update();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, __(\"Edit Title\"), __(\"Update\"));\n\t\t\t}\n\t\t\tif(me.can_rename()) {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}\n\t\t});\n\t},\n\tget_dropdown_menu: function(label) {\n\t\treturn this.page.add_dropdown(label);\n\t},\n\tset_indicator: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t},\n\tmake_menu: function() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\t\tvar me = this;\n\t\tvar p = this.frm.perm[0];\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar is_submittable = frappe.model.is_submittable(this.frm.doc.doctype)\n\t\tvar issingle = this.frm.meta.issingle;\n\t\tvar print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\tvar allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tvar allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\t// Print\n\t\tif(!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif(frappe.model.can_print(null, me.frm) && !issingle) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"fa fa-print\", function() {\n\t\t\t\t\tme.frm.print_doc();});\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();}, true);\n\t\t}\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// copy\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();}, true);\n\t\t}\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();}, true);\n\n\t\t// add to desktop\n\t\tif(me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Add to Desktop'), function () {\n\t\t\t\tfrappe.add_to_desktop(me.frm.doctype, me.frm.doctype);\n\t\t\t}, true);\n\t\t}\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();}, true);\n\t\t}\n\n\t\tif(frappe.user_roles.includes(\"System Manager\") && me.frm.meta.issingle === 0) {\n\t\t\tthis.page.add_menu_item(__(\"Customize\"), function() {\n\n\t\t\t\tif (me.frm.meta && me.frm.meta.custom) {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.set_route('Form', 'Customize Form', {\n\t\t\t\t\t\tdoc_type: me.frm.doctype\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, true);\n\n\t\t\tif (frappe.boot.developer_mode===1 && me.frm.meta.issingle) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), function() {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\t// feedback\n\t\tif(!this.frm.doc.__unsaved) {\n\t\t\tif(is_submittable && docstatus == 1) {\n\t\t\t\tthis.page.add_menu_item(__(\"Request Feedback\"), function() {\n\t\t\t\t\tvar feedback = new frappe.utils.Feedback();\n\t\t\t\t\tfeedback.manual_feedback_request(me.frm.doc);\n\t\t\t\t}, true)\n\t\t\t}\n\t\t}\n\n\t\t// New\n\t\tif(p[CREATE] && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__(\"New {0} (Ctrl+B)\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);}, true);\n\t\t}\n\t},\n\tcan_save: function() {\n\t\treturn this.get_docstatus()===0;\n\t},\n\tcan_submit: function() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_update: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved\n\t},\n\tcan_cancel: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only;\n\t},\n\tcan_amend: function() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t},\n\thas_workflow: function() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t},\n\tget_docstatus: function() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t},\n\tshow_linked_with: function() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t},\n\tset_primary_action: function(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\tif (status !== this.current_status) {\n\t\t\t\tif (status === 'Amend') {\n\t\t\t\t\tlet doc = this.frm.doc;\n\t\t\t\t\tfrappe.xcall('frappe.client.is_document_amended', {\n\t\t\t\t\t\t'doctype': doc.doctype,\n\t\t\t\t\t\t'docname': doc.name\n\t\t\t\t\t}).then(is_amended => {\n\t\t\t\t\t\tif (is_amended) return;\n\t\t\t\t\t\tthis.set_page_actions(status);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.set_page_actions(status);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null\n\t\t}\n\t},\n\tget_action_status: function() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t},\n\tset_page_actions: function(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'octicon octicon-pencil');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\tme.frm.savecancel(this);\n\t\t\t}, \"octicon octicon-circle-slash\");\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Save\": \"octicon octicon-check\",\n\t\t\t\t\"Submit\": \"octicon octicon-lock\",\n\t\t\t\t\"Update\": \"octicon octicon-check\",\n\t\t\t\t\"Amend\": \"octicon octicon-split\"\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t},\n\tadd_update_button_on_dirty: function() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t},\n\tshow_title_as_dirty: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tif(this.frm.doc.__unsaved) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.doc.__unsaved ? \"dirty\" : \"clean\");\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Dashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.section = this.frm.fields_dict._form_dashboard.wrapper;\n\t\tthis.parent = this.section.find('.section-body');\n\t\tthis.wrapper = $(frappe.render_template('form_dashboard',\n\t\t\t{frm: this.frm})).appendTo(this.parent);\n\n\t\tthis.progress_area = this.wrapper.find(\".progress-area\");\n\t\tthis.heatmap_area = this.wrapper.find('.form-heatmap');\n\t\tthis.chart_area = this.wrapper.find('.form-graph');\n\t\tthis.stats_area = this.wrapper.find('.form-stats');\n\t\tthis.stats_area_row = this.stats_area.find('.row');\n\t\tthis.links_area = this.wrapper.find('.form-links');\n\t\tthis.transactions_area = this.links_area.find('.transactions');\n\n\t},\n\treset: function() {\n\t\tthis.section.addClass('hidden');\n\t\tthis.clear_headline();\n\n\t\t// clear progress\n\t\tthis.progress_area.empty().addClass('hidden');\n\n\t\t// clear links\n\t\tthis.links_area.addClass('hidden');\n\t\tthis.links_area.find('.count, .open-notification').addClass('hidden');\n\n\t\t// clear stats\n\t\tthis.stats_area.addClass('hidden')\n\t\tthis.stats_area_row.empty();\n\n\t\t// clear custom\n\t\tthis.wrapper.find('.custom').remove();\n\t},\n\tset_headline: function(html) {\n\t\tthis.frm.layout.show_message(html);\n\t},\n\tclear_headline: function() {\n\t\tthis.frm.layout.show_message();\n\t},\n\n\tadd_comment: function(text, alert_class, permanent) {\n\t\tvar me = this;\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif(!permanent) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tme.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t},\n\n\tclear_comment: function() {\n\t\tthis.clear_headline();\n\t},\n\n\tset_headline_alert: function(text, indicator_color) {\n\t\tif (!indicator_color) {\n\t\t\tindicator_color = 'orange';\n\t\t}\n\t\tif(text) {\n\t\t\tthis.set_headline(`<div><span class=\"indicator ${indicator_color}\">${text}</span></div>`);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t},\n\n\tadd_section: function(html) {\n\t\treturn $('<div class=\"form-dashboard-section custom\">'+html+'</div>').appendTo(this.wrapper);\n\t},\n\n\tadd_progress: function(title, percent, message) {\n\t\tvar progress_chart = this.make_progress_chart(title);\n\n\t\tif(!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tvar progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(repl('<div class=\"progress-bar %(progress_class)s\" style=\"width: %(width)s\" \\\n\t\t\t\ttitle=\"%(title)s\"></div>', opts)).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t},\n\n\tshow_progress: function(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tif (!this._progress_map[title]) {\n\t\t\tconst progress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\t\tlet progress_chart = this._progress_map[title];\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find('.progress-bar').each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar).css('width', width)\n\t\t\t\t.removeClass('progress-bar-danger progress-bar-success')\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\tprogress_chart.find('.progress-message').text(message);\n\t},\n\n\thide_progress: function(title) {\n\t\tif (title){\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.empty();\n\t\t}\n\t},\n\n\tformat_percent: function(title, percent) {\n\t\tvar width = cint(percent) < 1 ? 1 : cint(percent);\n\t\tvar progress_class = \"\";\n\t\tif(width < 10)\n\t\t\tprogress_class = \"progress-bar-danger\";\n\t\tif(width > 99.9)\n\t\t\tprogress_class = \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t},\n\tmake_progress_chart: function(title) {\n\t\tvar progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.removeClass('hidden'));\n\t\treturn progress_chart;\n\t},\n\n\trefresh: function() {\n\t\tthis.reset();\n\t\tif(this.frm.doc.__islocal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tvar show = false;\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\tif(this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tthis.set_open_count();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show();\n\t\t}\n\t},\n\n\tafter_refresh: function() {\n\t\tvar me = this;\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.find('.btn-new').each(function() {\n\t\t\tif(me.frm.can_create($(this).attr('data-doctype'))) {\n\t\t\t\t$(this).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_data: function() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif(!this.data.transactions) this.data.transactions = [];\n\t\tif(!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t},\n\n\tadd_transactions: function(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif(!Array.isArray(opts)) opts=[opts];\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map(group => {\n\t\t\t\topts.map(d => {\n\t\t\t\t\tif(d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map(d => {\n\t\t\t\tif(!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t},\n\n\tfilter_permissions: function() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tvar transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tvar items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add thie group, if there is atleast\n\t\t\t// one item with permission\n\t\t\tif(items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t},\n\trender_links: function() {\n\t\tvar me = this;\n\t\tthis.links_area.removeClass('hidden');\n\t\tthis.links_area.find('.btn-new').addClass('hidden');\n\t\tif(this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\t//this.transactions_area.empty();\n\n\t\tthis.data.frm = this.frm;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(this.transactions_area)\n\n\t\t// bind links\n\t\tthis.transactions_area.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).parent());\n\t\t});\n\n\t\t// bind open notifications\n\t\tthis.transactions_area.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\tthis.transactions_area.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t},\n\topen_document_list: function($link, show_open) {\n\t\t// show document list with filters\n\t\tvar doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if(this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif(show_open) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t},\n\tget_document_filter: function(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tvar filter = {};\n\t\tvar fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t},\n\tset_open_count: function() {\n\t\tif(!this.data.transactions || !this.data.fieldname) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tvar items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) { items.push(item); });\n\t\t});\n\n\t\tvar method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t\titems: items\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, function(doctype, link) {\n\t\t\t\t\tvar table_fieldname = link[0], link_fieldname = link[1];\n\t\t\t\t\tvar names = [];\n\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(function(d) {\n\t\t\t\t\t\tvar value = d[link_fieldname];\n\t\t\t\t\t\tif(value && names.indexOf(value)===-1) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t},\n\tset_badge_count: function(doctype, open_count, count, names) {\n\t\tvar $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif(open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif(count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_heatmap: function(data) {\n\t\tif(this.heatmap) {\n\t\t\tthis.heatmap.update(data);\n\t\t}\n\t},\n\n\t// heatmap\n\trender_heatmap: function() {\n\t\tif(!this.heatmap) {\n\t\t\tthis.heatmap = new Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\theight: 120,\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 0,\n\t\t\t\tdata: {}\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.removeClass('hidden').find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tvar heatmap_message = this.heatmap_area.find('.heatmap-message');\n\t\t\tif(this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator: function(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.removeClass('hidden');\n\n\n\t\t// set colspan\n\t\tvar indicators = this.stats_area_row.find('.indicator-column');\n\t\tvar n_indicators = indicators.length + 1;\n\t\tvar colspan;\n\t\tif(n_indicators > 4) { colspan = 3 }\n\t\telse { colspan = 12 / n_indicators; }\n\n\t\t// reset classes in existing indicators\n\t\tif(indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tvar indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t},\n\n\t// graphs\n\tsetup_graph: function() {\n\t\tvar me = this;\n\t\tvar method = this.data.graph_method;\n\t\tvar args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trender_graph: function(args) {\n\t\tvar me = this;\n\t\tthis.chart_area.empty().removeClass('hidden');\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\tcolors: ['green']\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new Chart('.form-graph', args);\n\t\tif(!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\tshow: function() {\n\t\tthis.section.removeClass('hidden');\n\t},\n\n\thide: function() {\n\t\tthis.section.addClass('hidden');\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.document_flow');\n\nfrappe.ui.form.DocumentFlow = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.module = frappe.get_meta(this.frm.doctype).module\n\t\tif (!frappe.document_flow || !frappe.document_flow[this.module]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.doctypes = frappe.document_flow[this.module][this.frm.doctype];\n\t\tif (!this.doctypes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"document-flow-wrapper hidden\"></div>').prependTo(this.frm.layout.wrapper);\n\t},\n\n\trefresh: function() {\n\t\tif(this.doctypes) {\n\t\t\tthis.reset();\n\t\t\tthis.render();\n\t\t}\n\t},\n\n\treset: function() {\n\t\tthis.wrapper.empty().addClass('hidden');\n\t\tthis.linked_with = {};\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\n\t\t$(frappe.render_template('form_document_flow', {\n\t\t\tfrm: this.frm,\n\t\t\tdoctypes: this.doctypes,\n\t\t})).appendTo(this.wrapper.removeClass('hidden'));\n\n\t\tthis.wrapper.on('click', '.document-flow-link', function() {\n\t\t\tvar doctype = $(this).attr(\"data-doctype\");\n\t\t\tif (me.frm.doctype != doctype) {\n\t\t\t\tme.get_linked_docs(doctype);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!this.frm.doc.__islocal) {\n\t\t\tthis.mark_completed_flow()\n\t\t}\n\n\t},\n\n\tget_linked_docs: function(for_doctype) {\n\t\tif(!this.linked_with[for_doctype]) {\n\t\t\tthis.linked_with[for_doctype] = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t\tfor_doctype: for_doctype\n\t\t\t});\n\t\t}\n\n\t\tthis.linked_with[for_doctype].show();\n\t},\n\n\tmark_completed_flow: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.document_flow.get_document_completion_status\",\n\t\t\targs: {\n\t\t\t\tdoctypes: me.doctypes,\n\t\t\t\tfrm_doctype: me.frm.doctype,\n\t\t\t\tfrm_docname: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(!r.message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(me.doctypes, function(i, doctype) {\n\t\t\t\t\tif (r.message[doctype] && me.frm.doctype!=doctype) {\n\t\t\t\t\t\tme.wrapper.find(\"[data-doctype='\"+doctype+\"']a .indicator\")\n\t\t\t\t\t\t\t.removeClass(\"darkgrey\")\n\t\t\t\t\t\t\t.addClass(\"black\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tvar working_label = {\n\t\t\"Save\": __(\"Saving\"),\n\t\t\"Submit\": __(\"Submitting\"),\n\t\t\"Update\": __(\"Updating\"),\n\t\t\"Amend\": __(\"Amending\"),\n\t\t\"Cancel\": __(\"Cancelling\")\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif (check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/**\n\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\twhat users also consider to be an empty row\n\t\t */\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(function(d){\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\ttables.map(\n\t\t\tfunction(doc){\n\t\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\t\tconst in_list_view_cells = cells.filter(function(df) {\n\t\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t\t});\n\n\t\t\t\tvar is_empty_row = function(cells) {\n\t\t\t\t\tfor (var i=0; i < cells.length; i++){\n\t\t\t\t\t\tif(locals[doc.doctype][doc.name][cells[i].fieldname]){\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar me = this;\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tvar df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, frm.doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (df.reqd && !frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tif (doc.parenttype) {\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}',\n\t\t\t\t\t\t[__(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold(), doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tvar scroll_to = function (fieldname) {\n\t\tvar f = cur_frm.fields_dict[fieldname];\n\t\tif (f) {\n\t\t\t$(document).scrollTop($(f.wrapper).offset().top - 60);\n\t\t}\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\t// ensure we remove new docs routes ONLY\n\t\tif ( frm.is_new() ) {\n\t\t\tfrappe.ui.form.remove_old_form_route();\n\t\t}\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet current_route = frappe.get_route().join(\"/\");\n\tfrappe.route_history = frappe.route_history\n\t\t.filter((route) => route.join(\"/\") !== current_route);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (frappe._from_link && newdoc.doctype === frappe._from_link.df.options) {\n\t\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\t\t// set value\n\t\tif (doc && doc.parentfield) {\n\t\t\t//update values for child table\n\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t}\n\n\t\t// refresh field\n\t\tfrappe._from_link.refresh();\n\n\t\t// if from form, switch\n\t\tif (frappe._from_link.frm) {\n\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t});\n\t\t}\n\n\t\tfrappe._from_link = null;\n\t}\n}\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\t\thandler_list.push(handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tmake: function(ControllerClass) {\n\t\tthis.frm.cscript = $.extend(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t},\n\ttrigger: function(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t},\n\thas_handlers: function(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t},\n\tget_handlers: function(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t},\n\tsetup: function() {\n\t\tvar doctype = this.frm.meta;\n\t\tvar me = this;\n\n\t\t// js\n\t\tvar cs = doctype.__js;\n\t\tif(cs) {\n\t\t\tvar tmp = eval(cs);\n\t\t}\n\n\t\tif(doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Custom Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tif((['Data', 'Read Only', 'Text', 'Small Text', 'Currency',\n\t\t\t\t'Text Editor', 'Code', 'Link', 'Float', 'Int', 'Date'].includes(df.fieldtype) || df.read_only==1)\n\t\t\t\t&& df.fetch_from && df.fetch_from.indexOf(\".\")!=-1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(field.df.fieldtype===\"Table\") {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t},\n\tlog_error: function(caller, e) {\n\t\tfrappe.show_alert(\"Error in Client Script.\");\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t},\n\tcopy_from_first_row: function(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\thide_on_page_refresh: true,\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\t// execute ajax calls sequentially\n\t\t\t// 1. get linked doctypes\n\t\t\t// 2. load all doctypes\n\t\t\t// 3. load linked docs\n\t\t\tthis.get_linked_doctypes()\n\t\t\t\t.then(() => this.load_doctypes())\n\t\t\t\t.then(() => this.links_not_permitted_or_missing())\n\t\t\t\t.then(() => this.get_linked_docs())\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tconst linked_docs = this.frm.__linked_docs;\n\n\t\tlet html = '';\n\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tload_doctypes() {\n\t\tconst already_loaded = Object.keys(locals.DocType);\n\t\tlet doctypes_to_load = [];\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tdoctypes_to_load =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(doctype => !already_loaded.includes(doctype));\n\t\t}\n\n\t\t// load all doctypes asynchronously using with_doctype\n\t\tconst promises = doctypes_to_load.map(dt => {\n\t\t\treturn frappe.model.with_doctype(dt, () => {\n\t\t\t\tif(frappe.listview_settings[dt]) {\n\t\t\t\t\t// add additional fields to __linked_doctypes\n\t\t\t\t\tthis.frm.__linked_doctypes[dt].add_fields =\n\t\t\t\t\t\tfrappe.listview_settings[dt].add_fields;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tlinks_not_permitted_or_missing() {\n\t\tlet links = null;\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tlinks =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(frappe.model.can_get_report);\n\t\t}\n\n\t\tlet flag;\n\t\tif(!links) {\n\t\t\t$(this.dialog.body).html(`${this.frm.__linked_doctypes\n\t\t\t\t? __(\"Not enough permission to see links\")\n\t\t\t\t: __(\"Not Linked to any record\")}`);\n\t\t\tflag = true;\n\t\t}\n\t\tflag = false;\n\n\t\t// reject Promise if not_permitted or missing\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => flag ? reject() : resolve()\n\t\t);\n\t}\n\n\tget_linked_doctypes() {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm.__linked_doctypes) {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_doctypes\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.frm.__linked_doctypes = r.message;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_linked_docs() {\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tlinkinfo: this.frm.__linked_doctypes,\n\t\t\t\tfor_doctype: this.for_doctype\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.frm.__linked_docs = r.message || {};\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"#Form/${doctype}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\n\tsetup_help: function() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t});\n\n\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\tvar next_html = $.map(transitions,\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\treturn d.action.bold() + __(\" by Role \") + d.allowed;\n\t\t\t\t\t}).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t$(d.body).html(\"<p>\"+__(\"Current status\")+\": \" + state.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Document is only editable by users of role\")+\": \"\n\t\t\t\t\t\t+ frappe.workflow.get_document_state(me.frm.doctype,\n\t\t\t\t\t\t\tstate).allow_edit.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Next actions\")+\": \"+ next_html +\"</p>\"\n\t\t\t\t\t+ (me.frm.doc.__islocal ? (\"<div class='alert alert-info'>\"\n\t\t\t\t\t\t+__(\"Workflow will start after saving.\")+\"</div>\") : \"\")\n\t\t\t\t\t+ \"<p class='help'>\"+__(\"Note: Other permission rules may also apply\")+\"</p>\"\n\t\t\t\t).css({padding: '15px'});\n\t\t\t\td.show();\n\t\t\t});\n\t\t}, true);\n\t},\n\n\trefresh: function() {\n\t\tconst me = this;\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tlet doctype = this.frm.doctype;\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t},\n\n\tshow_actions: function() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\tthis.frm.page.clear_actions_menu();\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (user === 'Administrator'\n\t\t\t\t|| transition.allow_self_approval\n\t\t\t\t|| user !== me.frm.doc.owner) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then(transitions => {\n\t\t\t$.each(transitions, function(i, d) {\n\t\t\t\tif(frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.apply_workflow',\n\t\t\t\t\t\t\t{doc: me.frm.doc, action: d.action})\n\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.setup_btn(added);\n\t\t});\n\n\t},\n\n\tsetup_btn: function(action_added) {\n\t\tif(action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t},\n\n\tset_default_state: function() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t},\n\n\tget_state: function() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.PrintPreview = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.bind_events();\n\t},\n\tmake: function () {\n\t\tthis.wrapper = this.frm.page.add_view(\"print\", frappe.render_template(\"print_layout\", {}));\n\n\t\t// only system manager can edit\n\t\tthis.wrapper.find(\".btn-print-edit\").toggle(frappe.user.has_role(\"System Manager\"));\n\t},\n\tbind_events: function () {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".btn-print-close\").click(function () {\n\t\t\tme.frm.hide_print();\n\t\t});\n\n\t\t// hide print view on pressing escape, only if there is no focus on any input\n\t\t$(document).on(\"keydown\", function (e) {\n\t\t\tif (e.which === 27 && me.frm && e.target === document.body) {\n\t\t\t\tme.frm.hide_print();\n\t\t\t}\n\t\t});\n\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.meta.name);\n\t\tthis.print_letterhead = this.wrapper\n\t\t\t.find(\".print-letterhead\")\n\t\t\t.on(\"change\", function () { me.print_sel.trigger(\"change\"); })\n\t\t\t.prop(\"checked\", cint(\n\t\t\t\t(frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\t\t\t\t|| { with_letterhead: 1 }).with_letterhead) ? true : false);\n\t\tthis.print_sel = this.wrapper\n\t\t\t.find(\".print-preview-select\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.set_default_print_language();\n\t\t\t\tme.multilingual_preview();\n\t\t\t});\n\n\t\t//On selection of language get code and pass it to preview method\n\t\tthis.language_sel = this.wrapper\n\t\t\t.find(\".languages\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.lang_code = me.language_sel.val()\n\t\t\t\tme.multilingual_preview()\n\t\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-print\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.print_old_style();\n\t\t\t} else {\n\t\t\t\tme.printit();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-preview\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.new_page_preview_old_style();\n\t\t\t} else {\n\t\t\t\tme.new_page_preview();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-download-pdf\").click(function () {\n\t\t\tif (!me.is_old_style()) {\n\t\t\t\tvar w = window.open(\n\t\t\t\t\tfrappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t\t\t\t+ \"&format=\" + encodeURIComponent(me.selected_format())\n\t\t\t\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\"))\n\t\t\t\t);\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-edit\").on(\"click\", function () {\n\t\t\tlet print_format = me.get_print_format();\n\t\t\tlet is_custom_format = print_format.name\n\t\t\t\t&& print_format.print_format_builder\n\t\t\t\t&& print_format.standard === 'No';\n\t\t\tlet is_standard_but_editable = print_format.name && print_format.custom_format;\n\n\t\t\tif (is_standard_but_editable) {\n\t\t\t\tfrappe.set_route(\"Form\", \"Print Format\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (is_custom_format) {\n\t\t\t\tfrappe.set_route(\"print-format-builder\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// start a new print format\n\t\t\tfrappe.prompt([\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"New Print Format Name\"),\n\t\t\t\t\tfieldname: \"print_format_name\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Based On'),\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\tfieldtype: 'Read Only',\n\t\t\t\t\tdefault: print_format.name || 'Standard'\n\t\t\t\t}\n\t\t\t], function (data) {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tmake_new: true,\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: data.print_format_name,\n\t\t\t\t\tbased_on: data.based_on\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"print-format-builder\");\n\t\t\t}, __(\"New Custom Print Format\"), __(\"Start\"));\n\t\t});\n\t},\n\tset_user_lang: function () {\n\t\tthis.lang_code = this.frm.doc.language;\n\t\t// Load all languages in the field\n\t\tthis.language_sel.empty()\n\t\t\t.add_options([{value:'', label:__(\"Select Language...\")}]\n\t\t\t\t.concat(frappe.get_languages()))\n\t\t\t.val(this.lang_code);\n\t\tthis.preview();\n\t},\n\tset_default_print_language: function () {\n\t\tvar print_format = this.get_print_format();\n\t\tthis.lang_code = print_format.default_print_language || this.frm.doc.language || frappe.boot.lang;\n\t\tthis.language_sel.val(this.lang_code);\n \t},\n\tmultilingual_preview: function () {\n\t\tvar me = this;\n\t\tif (this.is_old_style()) {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.set_style();\n\t\t\tme.preview_old_style();\n\t\t} else {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(true);\n\t\t\tme.preview();\n\t\t}\n\t},\n\tpreview: function () {\n\t\tvar me = this;\n\t\tthis.get_print_html(function (out) {\n\t\t\tconst $print_format = me.wrapper.find(\".print-format\");\n\t\t\t$print_format.html(out.html);\n\t\t\tme.show_footer();\n\t\t\tme.set_style(out.style);\n\n\t\t\tconst print_height = $print_format.get(0).offsetHeight;\n\t\t\tconst $message = me.wrapper.find(\".page-break-message\");\n\n\t\t\tconst print_height_inches = frappe.dom.pixel_to_inches(print_height);\n\t\t\t// if contents are large enough, indicate that it will get printed on multiple pages\n\t\t\t// Maximum height for an A4 document is 11.69 inches\n\t\t\tif (print_height_inches > 11.69) {\n\t\t\t\t$message.text(__('This may get printed on multiple pages'));\n\t\t\t} else {\n\t\t\t\t$message.text('');\n\t\t\t}\n\t\t});\n\t},\n\tshow_footer: function() {\n\t\t// footer is hidden by default as reqd by pdf generation\n\t\t// simple hack to show it in print preview\n\t\tthis.wrapper.find('.print-format').css({\n\t\t\tdisplay: 'flex',\n\t\t\tflexDirection: 'column'\n\t\t});\n\t\tthis.wrapper.find('.page-break').css({\n\t\t\t'display': 'flex',\n\t\t\t'flex-direction': 'column',\n\t\t\t'flex': '1'\n\t\t});\n\t\tthis.wrapper.find('#footer-html').attr('style', `\n\t\t\tdisplay: block !important;\n\t\t\torder: 1;\n\t\t\tmargin-top: auto;\n\t\t`);\n\t},\n\tprintit: function () {\n\t\tlet print_server ;\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.printing.doctype.print_settings.print_settings.is_print_server_enabled\",\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\"method\": \"frappe.utils.print_format.print_by_server\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tprint_format:  me.selected_format(),\n\t\t\t\t\t\t\tno_letterhead: me.with_letterhead()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tme.new_page_preview(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tnew_page_preview: function (printit) {\n\t\tvar me = this;\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/printview?\"\n\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t+ (printit ? \"&trigger_print=1\" : \"\")\n\t\t\t+ \"&format=\" + encodeURIComponent(me.selected_format())\n\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\")));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t}\n\t},\n\tget_print_html: function (callback) {\n\t\tif (this._req) {\n\t\t\tthis._req.abort();\n\t\t}\n\t\tthis._req = frappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_html_and_style\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\tno_letterhead: !this.with_letterhead() ? 1 : 0,\n\t\t\t\t_lang: this.lang_code,\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tpreview_old_style: function () {\n\t\tvar me = this;\n\t\tthis.with_old_style({\n\t\t\tformat: me.print_sel.val(),\n\t\t\tcallback: function (html) {\n\t\t\t\tme.wrapper.find(\".print-format\").html('<div class=\"alert alert-warning\">'\n\t\t\t\t\t+ __(\"Warning: This Print Format is in old style and cannot be generated via the API.\")\n\t\t\t\t\t+ '</div>'\n\t\t\t\t\t+ html);\n\t\t\t},\n\t\t\tno_letterhead: !this.with_letterhead(),\n\t\t\tonly_body: true,\n\t\t\tno_heading: true\n\t\t});\n\t},\n\trefresh_print_options: function () {\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.doctype);\n\t\treturn this.print_sel\n\t\t\t.empty().add_options(this.print_formats);\n\n\t},\n\twith_old_style: function (opts) {\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(opts.format, opts.callback, opts.no_letterhead, opts.only_body, opts.no_heading);\n\t\t});\n\t},\n\tprint_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.go,\n\t\t\t\t!me.with_letterhead());\n\t\t});\n\t},\n\tnew_page_preview_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.preview, !me.with_letterhead());\n\t\t});\n\t},\n\tselected_format: function () {\n\t\treturn this.print_sel.val() || this.frm.meta.default_print_format || \"Standard\";\n\t},\n\tis_old_style: function (format) {\n\t\treturn this.get_print_format(format).print_format_type === \"Client\";\n\t},\n\tget_print_format: function (format) {\n\t\tif (!format) {\n\t\t\tformat = this.selected_format();\n\t\t}\n\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\treturn locals[\"Print Format\"][format]\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t},\n\twith_letterhead: function () {\n\t\treturn this.print_letterhead.is(\":checked\") ? 1 : 0;\n\t},\n\tset_style: function (style) {\n\t\tfrappe.dom.set_style(style || frappe.boot.print_css, \"print-style\");\n\t}\n});\n\nfrappe.ui.get_print_settings = function (pdf, callback, letter_head) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head = locals[\":Company\"] && frappe.defaults.get_default('company')\n\t\t? locals[\":Company\"][frappe.defaults.get_default('company')][\"default_letter_head\"]\n\t\t: '';\n\n\tvar columns = [{\n\t\tfieldtype: \"Check\",\n\t\tfieldname: \"with_letter_head\",\n\t\tlabel: __(\"With Letter head\")\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"letter_head\",\n\t\tlabel: __(\"Letter Head\"),\n\t\tdepends_on: \"with_letter_head\",\n\t\toptions: $.map(frappe.boot.letter_heads, function (i, d) { return d }),\n\t\tdefault: letter_head || default_letter_head\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"orientation\",\n\t\tlabel: __(\"Orientation\"),\n\t\toptions: \"Landscape\\nPortrait\",\n\t\tdefault: \"Landscape\"\n\t}];\n\n\tfrappe.prompt(columns, function (data) {\n\t\tvar data = $.extend(print_settings, data);\n\t\tif (!data.with_letter_head) {\n\t\t\tdata.letter_head = null;\n\t\t}\n\t\tif (data.letter_head) {\n\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t}\n\t\tcallback(data);\n\t}, __(\"Print Settings\"));\n}\n","frappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Sidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.ratings = this.sidebar.find(\".sidebar-rating\");\n\t\tthis.comments = this.sidebar.find(\".sidebar-comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_shared();\n\t\tthis.make_viewers();\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\n\t\tthis.bind_events();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t},\n\n\tbind_events: function() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".form-comments\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_icon, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t})\n\t},\n\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\t\t\tthis.frm.viewers.refresh();\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.doc._user_tags);\n\t\t\tthis.sidebar.find(\".modified-by\").html(__(\"{0} edited this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.modified_by) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified)]));\n\t\t\tthis.sidebar.find(\".created-by\").html(__(\"{0} created this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.owner) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation)]));\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.setup_ratings();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t},\n\n\trefresh_comments: function() {\n\t\t$.map(this.frm.timeline.get_communications(), function(c) {\n\t\t\treturn (c.communication_type===\"Communication\" || (c.communication_type==\"Comment\" && c.comment_type===\"Comment\")) ? c : null;\n\t\t});\n\t\tthis.comments.find(\".n-comments\").html(this.frm.get_docinfo().total_comments);\n\t},\n\n\tmake_tags: function() {\n\t\tvar me = this;\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: this.sidebar.find(\".tag-area\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tme.frm.doc._user_tags = user_tags;\n\t\t\t}\n\t\t});\n\t},\n\tmake_attachments: function() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t},\n\tmake_assignments: function() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\tmake_shared: function() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t},\n\tmake_viewers: function() {\n\t\tthis.frm.viewers = new frappe.ui.form.Viewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-viewers\")\n\t\t});\n\t},\n\tadd_user_action: function(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t},\n\tclear_user_actions: function() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t},\n\n\tmake_like: function() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .octicon-heart\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .likes-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".liked-by-parent\"), \".liked-by\");\n\t},\n\n\trefresh_like: function() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\n\t\tthis.like_icon.toggleClass(\"text-extra-muted not-liked\",\n\t\t\t!frappe.ui.is_liked(this.frm.doc))\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t},\n\n\trefresh_image: function() {\n\t},\n\n\tsetup_ratings: function() {\n\t\tvar _ratings = this.frm.get_docinfo().rating || 0;\n\n\t\tif(_ratings) {\n\t\t\tthis.ratings.removeClass(\"hide\");\n\t\t\tvar rating_icons = frappe.render_template(\"rating_icons\", {rating: _ratings, show_label: false});\n\t\t\tthis.ratings.find(\".rating-icons\").html(rating_icons);\n\t\t}\n\t}\n});\n","frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css('background-color', '')\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.html('');\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', function() {\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif(!field.$input) {\n\t\t\tfield.make_input();\n\t\t}\n\t\tfield.$input.trigger('click');\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Share = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\trefresh: function() {\n\t\tthis.render_sidebar();\n\t},\n\trender_sidebar: function() {\n\t\tvar me = this;\n\t\tthis.parent.empty();\n\n\t\tvar shared = this.shared || this.frm.get_docinfo().shared;\n\t\tshared = shared.filter(function(d) { return d });\n\t\tvar users = [];\n\t\tfor (var i=0, l=shared.length; i < l; i++) {\n\t\t\tvar s = shared[i];\n\n\t\t\tif (s.everyone) {\n\t\t\t\tusers.push({\n\t\t\t\t\ticon: \"octicon octicon-megaphone text-muted\",\n\t\t\t\t\tavatar_class: \"avatar-empty share-doc-btn shared-with-everyone\",\n\t\t\t\t\ttitle: __(\"Shared with everyone\")\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar user_info = frappe.user_info(s.user);\n\t\t\t\tusers.push({\n\t\t\t\t\timage: user_info.image,\n\t\t\t\t\tfullname: user_info.fullname,\n\t\t\t\t\tabbr: user_info.abbr,\n\t\t\t\t\tcolor: user_info.color,\n\t\t\t\t\ttitle: __(\"Shared with {0}\", [user_info.fullname])\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!me.frm.doc.__islocal) {\n\t\t\tusers.push({\n\t\t\t\ticon: \"octicon octicon-plus text-muted\",\n\t\t\t\tavatar_class: \"avatar-empty share-doc-btn\",\n\t\t\t\ttitle: __(\"Share\")\n\t\t\t});\n\t\t}\n\n\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\tthis.parent.find(\".avatar\").on(\"click\", function() {\n\t\t\tme.frm.share_doc();\n\t\t});\n\t},\n\tshow: function() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t},\n\trender_shared: function(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t},\n\tmake_user_input: function() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t},\n\tadd_share_button: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: $(d.body).find(\".add-share-notify\").prop(\"checked\") ? 1 : 0\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_edit_share_events: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Viewers = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tget_viewers: function() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\tif (docinfo) {\n\t\t\treturn docinfo.viewers || {};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\trefresh: function(data_updated) {\n\t\tthis.parent.empty();\n\n\t\tvar viewers = this.get_viewers();\n\n\t\tvar users = [];\n\t\tvar new_users = [];\n\t\tfor (var i=0, l=(viewers.current || []).length; i < l; i++) {\n\t\t\tvar username = viewers.current[i];\n\t\t\tif (username===frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tusers.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently viewing this document\", [user_info.fullname])\n\t\t\t});\n\n\t\t\tif (viewers.new.indexOf(username)!==-1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\t\t}\n\n\t\tif (users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\tif (data_updated && new_users.length) {\n\t\t\t// new user viewing this document, who wasn't viewing in the past\n\t\t\tif (new_users.length===1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently viewing this document\", [new_users[0]]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__(\"{0} are currently viewing this document\", [frappe.utils.comma_and(new_users)]));\n\t\t\t}\n\n\t\t}\n\t}\n});\n\nfrappe.ui.form.set_viewers = function(data) {\n\tvar doctype = data.doctype;\n\tvar docname = data.docname;\n\tvar docinfo = frappe.model.get_docinfo(doctype, docname);\n\tvar past_viewers = ((docinfo && docinfo.viewers) || {}).past || [];\n\tvar viewers = data.viewers || [];\n\n\tvar new_viewers = viewers.filter(viewer => !past_viewers.includes(viewer));\n\n\tfrappe.model.set_docinfo(doctype, docname, \"viewers\", {\n\t\tpast: past_viewers.concat(new_viewers),\n\t\tnew: new_viewers,\n\t\tcurrent: viewers\n\t});\n\n\tif (cur_frm && cur_frm.doc && cur_frm.doc.doctype===doctype && cur_frm.doc.name==docname) {\n\t\tcur_frm.viewers.refresh(true);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Footer = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comments();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(function() {\n\t\t\tme.frm.save('Save', null, this);\n\t\t})\n\n\t},\n\tmake_comments: function() {\n\t\tthis.frm.timeline = new frappe.ui.form.Timeline({\n\t\t\tparent: this.wrapper.find(\".form-comments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Attachments = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add_attachment\").parent();\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t},\n\tmax_reached: function() {\n\t\t// no of attachments\n\t\tvar n = Object.keys(this.get_attachments()).length;\n\n\t\t// button if the number of attachments is less than max\n\t\tif(n < this.frm.meta.max_attachments || !this.frm.meta.max_attachments) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\trefresh: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggleClass(\"hide\", !max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tattachments.forEach(function(attachment) {\n\t\t\t\tme.add_attachment(attachment)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t},\n\tget_attachments: function() {\n\t\treturn this.frm.get_docinfo().attachments;\n\t},\n\tadd_attachment: function(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tvar $attach = $(frappe.render_template(\"attachment\", { \n\t\t\t\"file_path\": \"/desk#Form/File/\" + fileid,\n\t\t\t\"icon\": attachment.is_private ? \"fa fa-lock\" : \"fa fa-unlock-alt\",\n\t\t\t\"file_name\": file_name,\n\t\t\t\"file_url\": frappe.urllib.get_full_url(file_url)\n\t\t})).insertAfter(this.attachments_label.addClass(\"has-attachments\"));\t\t\t\n\n\t\tvar $close =\n\t\t\t$attach.find(\".close\")\n\t\t\t.data(\"fileid\", fileid)\n\t\t\t.click(function() {\n\t\t\t\tvar remove_btn = this;\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tme.remove_attachment($(remove_btn).data(\"fileid\"))\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false\n\t\t\t});\n\n\t\tif(!frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\t$close.remove();\n\t\t}\n\t},\n\tget_file_url: function(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t},\n\tget_file_id_from_file_url: function(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t},\n\tremove_attachment_by_filename: function(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t},\n\tremove_attachment: function(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.get_docinfo().communications.push(r.message);\n\t\t\t\tme.frm.timeline && me.frm.timeline.refresh();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t},\n\tnew_attachment: function(fieldname) {\n\t\tvar me = this;\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\t// make upload dialog\n\t\tthis.dialog = frappe.ui.get_upload_dialog({\n\t\t\t\"args\": me.get_args(),\n\t\t\t\"callback\": function(attachment, r) { me.attachment_uploaded(attachment, r) },\n\t\t\t\"max_width\": me.frm.cscript ? me.frm.cscript.attachment_max_width : null,\n\t\t\t\"max_height\": me.frm.cscript ? me.frm.cscript.attachment_max_height : null\n\t\t});\n\t},\n\tget_args: function() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t},\n\tattachment_uploaded:  function(attachment, r) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment, r.message.comment);\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t},\n\tupdate_attachment: function(attachment, comment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t\tif(comment) {\n\t\t\t\tthis.frm.get_docinfo().communications.push(comment);\n\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t}\n\t\t}\n\t},\n\tadd_to_attachments: function (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t},\n\tremove_fileid: function(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n});\n\nfrappe.ui.get_upload_dialog = function(opts){\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __('Upload Attachment'),\n\t\tno_focus: true,\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Section Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"file\" ,\n\t\t\t\t\"label\": __(\"Select uploaded file\"),\n\t\t\t\t\"options\": \"File\",\n\t\t\t\tonchange: function() {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t'method': 'frappe.client.get_value',\n\t\t\t\t\t\t'args': {\n\t\t\t\t\t\t\t'doctype': 'File',\n\t\t\t\t\t\t\t'fieldname': ['file_url','file_name','is_private'],\n\t\t\t\t\t\t\t'filters': {\n\t\t\t\t\t\t\t\t'name': dialog.get_value(\"file\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(\"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(r.message.file_url);\n\t\t\t\t\t\t\tdialog.$wrapper.find('.private-file input').prop('checked', r.message.is_private);\n\t\t\t\t\t\t\topts.args.filename = r.message.file_name;\n\t\t\t\t\t\t\topts.args.is_private = r.message.is_private;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"hidden\": !opts.args.doctype || !frappe.boot.gsuite_enabled,\n\t\t\t\t\"fieldtype\": \"Section Break\",\n\t\t\t\t\"label\": __(\"GSuite Document\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"gs_template\" ,\n\t\t\t\t\"label\": __(\"Select template\"),\n\t\t\t\t\"options\": \"GSuite Templates\",\n\t\t\t\t\"reqd\" : false,\n\t\t\t\t\"filters\": {\n\t\t\t\t\t'related_doctype': opts.args.doctype\n\t\t\t\t},\n\t\t\t\tonchange: function(){\n\t\t\t\t\topts.args.gs_template = this.get_value();\n\t\t\t\t}\n\t\t\t},\n\t\t],\n\t});\n\n\n\n\n\tvar btn = dialog.set_primary_action(__(\"Attach\"));\n\tbtn.removeClass(\"btn-primary\").addClass(\"btn-default\");\n\n\tdialog.show();\n\tvar upload_area = $('<div></div>').prependTo(dialog.body);\n\n\t\n\n\tfrappe.upload.make({\n\t\tparent: upload_area,\n\t\targs: opts.args,\n\t\tcallback: function(attachment, r) {\n\t\t\tdialog.hide();\n\t\t\tif(opts.callback){\n\t\t\t\topts.callback(attachment, r);\n\t\t\t}\n\t\t},\n\t\ton_select: function() {\n\t\t\tbtn.removeClass(\"btn-default\").addClass(\"btn-primary\");\n\t\t},\n\t\tonerror: function() {\n\t\t\tdialog.hide();\n\t\t},\n\t\tbtn: btn,\n\t\tmax_width: opts.max_width,\n\t\tmax_height: opts.max_height,\n\t});\n\n\treturn dialog;\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.timeline');\nfrappe.separator_element = '<div>---</div>';\n\nfrappe.ui.form.Timeline = class Timeline {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"timeline\",\n\t\t\t{doctype: me.frm.doctype, allow_events_in_timeline: me.frm.meta.allow_events_in_timeline})).appendTo(me.parent);\n\n\t\tthis.list = this.wrapper.find(\".timeline-items\");\n\n\t\tthis.comment_area = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find('.timeline-head'),\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\ton_submit: (val) => {\n\t\t\t\tstrip_html(val) && this.insert_comment(\"Comment\", val, this.comment_area.button);\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_email_button();\n\t\tthis.setup_interaction_button();\n\n\t\tthis.list.on(\"click\", \".toggle-blockquote\", function() {\n\t\t\t$(this).parent().siblings(\"blockquote\").toggleClass(\"hidden\");\n\t\t});\n\n\t\tthis.setup_comment_like();\n\n\t\tthis.list.on(\"click\", \".btn-more\", function() {\n\t\t\tvar communications = me.get_communications();\n\t\t\tfrappe.call({\n\t\t\t\tbtn: this,\n\t\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tstart: communications.length\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tvar new_communications = r.message;\n\t\t\t\t\t\t\tvar communications = me.get_communications().concat(new_communications);\n\t\t\t\t\t\t\tfrappe.model.set_docinfo(me.frm.doc.doctype, me.frm.doc.name, \"communications\", communications);\n\n\t\t\t\t\t\t\tif (new_communications.length < 20) {\n\t\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t}\n\n\tsetup_email_button() {\n\t\tvar me = this;\n\t\tvar selector = this.frm.doctype === \"Communication\"? \".btn-reply-email\": \".btn-new-email\";\n\t\tthis.email_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tconst $btn = $(this);\n\t\t\t\tlet is_a_reply = true;\n\t\t\t\tif ($btn.is('.btn-new-email')) {\n\t\t\t\t\tis_a_reply = false;\n\t\t\t\t}\n\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient(),\n\t\t\t\t\tis_a_reply\n\t\t\t\t}\n\n\t\t\t\tif(me.frm.doctype === \"Communication\") {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: \"\",\n\t\t\t\t\t\tlast_email: me.frm.doc,\n\t\t\t\t\t\trecipients: me.frm.doc.sender,\n\t\t\t\t\t\tsubject: __(\"Re: {0}\", [me.frm.doc.subject]),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst comment_value = frappe.markdown(me.comment_area.get_value());\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: strip_html(comment_value) ? comment_value : ''\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnew frappe.views.CommunicationComposer(args)\n\t\t\t});\n\t}\n\n\tsetup_interaction_button() {\n\t\tvar me = this;\n\t\tvar selector = \".btn-new-interaction\";\n\t\tthis.activity_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient()\n\t\t\t\t}\n\t\t\t\t$.extend(args, {\n\t\t\t\t\ttxt: frappe.markdown(me.comment_area.get_value())\n\t\t\t\t});\n\t\t\t\tnew frappe.views.InteractionComposer(args);\n\t\t\t});\n\t}\n\n\tsetup_editing_area() {\n\t\tthis.$editing_area = $('<div class=\"timeline-editing-area\">');\n\n\t\tthis.editing_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.$editing_area,\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\tno_wrapper: true\n\t\t});\n\n\t\tthis.editing_area.destroy();\n\t}\n\n\trefresh(scroll_to_end) {\n\t\tvar me = this;\n\t\tthis.last_type = \"Comment\";\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.wrapper.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.wrapper.toggle(true);\n\t\tthis.list.empty();\n\t\tthis.comment_area.set_value('');\n\t\tlet communications = this.get_communications(true);\n\t\tvar views = this.get_view_logs();\n\n\t\tvar timeline = communications.concat(views);\n\t\ttimeline\n\t\t\t.filter(a => a.content)\n\t\t\t.sort((b, c) => me.compare_dates(b, c))\n\t\t\t.forEach(d => {\n\t\t\t\td.frm = me.frm;\n\t\t\t\tme.render_timeline_item(d);\n\t\t\t});\n\n\n\n\t\t// more btn\n\t\tif (this.more===undefined && timeline.length===20) {\n\t\t\tthis.more = true;\n\t\t}\n\n\t\tif (this.more) {\n\t\t\t$('<div class=\"timeline-item\">\\\n\t\t\t\t<button class=\"btn btn-default btn-xs btn-more\">More</button>\\\n\t\t\t</div>').appendTo(me.list);\n\t\t}\n\n\t\t// created\n\t\tme.render_timeline_item({\n\t\t\tcontent: __(\"created\"),\n\t\t\tcomment_type: \"Created\",\n\t\t\tcommunication_type: \"Comment\",\n\t\t\tsender: this.frm.doc.owner,\n\t\t\tcommunication_date: this.frm.doc.creation,\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tfrm: this.frm\n\t\t});\n\n\t\tthis.wrapper.find(\".is-email\").prop(\"checked\", this.last_type===\"Email\").change();\n\n\t\tthis.frm.sidebar.refresh_comments();\n\n\t\tthis.frm.trigger('timeline_refresh');\n\t}\n\n\tcompare_dates(b, c) {\n\t\tlet b_date = b.communication_date ? b.communication_date : b.creation;\n\t\tlet c_date = c.communication_date ? c.communication_date : c.creation;\n\t\tlet comparison = new Date(b_date) > new Date(c_date) ? -1 : 1;\n\t\treturn comparison;\n\t}\n\n\tmake_editing_area(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true\n\t\t});\n\t}\n\n\trender_timeline_item(c) {\n\t\tvar me = this;\n\t\tthis.prepare_timeline_item(c);\n\t\tvar $timeline_item = $(frappe.render_template(\"timeline_item\", {data:c, frm:this.frm}))\n\t\t\t.appendTo(me.list)\n\t\t\t.on(\"click\", \".delete-comment\", function() {\n\t\t\t\tvar name = $timeline_item.data('name');\n\t\t\t\tme.delete_comment(name);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.edit-comment', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar name = $timeline_item.data('name');\n\n\t\t\t\tif($timeline_item.hasClass('is-editing')) {\n\t\t\t\t\tme.current_editing_area.submit();\n\t\t\t\t} else {\n\t\t\t\t\tconst $edit_btn = $(this);\n\t\t\t\t\tconst $timeline_content = $timeline_item.find('.timeline-item-content');\n\t\t\t\t\tconst $timeline_edit = $timeline_item.find('.timeline-item-edit');\n\t\t\t\t\tconst content = $timeline_content.html();\n\n\t\t\t\t\t// update state\n\t\t\t\t\t$edit_btn\n\t\t\t\t\t\t.text(__(\"Save\"))\n\t\t\t\t\t\t.find('i')\n\t\t\t\t\t\t.removeClass('octicon-pencil')\n\t\t\t\t\t\t.addClass('octicon-check');\n\t\t\t\t\t$timeline_content.hide();\n\t\t\t\t\t$timeline_item.addClass('is-editing');\n\n\t\t\t\t\t// initialize editing area\n\t\t\t\t\tme.current_editing_area = me.make_editing_area($timeline_edit);\n\t\t\t\t\tme.current_editing_area.set_value(content);\n\n\t\t\t\t\t// submit handler\n\t\t\t\t\tme.current_editing_area.on_submit = (value) => {\n\t\t\t\t\t\t$timeline_edit.empty();\n\t\t\t\t\t\t$timeline_content.show();\n\n\t\t\t\t\t\t// set content to new val so that on save and refresh the new content is shown\n\t\t\t\t\t\tc.content = value;\n\t\t\t\t\t\tfrappe.timeline.update_communication(c);\n\t\t\t\t\t\tme.update_comment(name, value);\n\t\t\t\t\t\t// all changes to the timeline_item for editing are reset after calling refresh\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\n\t\tif(c.communication_type==\"Communication\" && c.communication_medium===\"Email\") {\n\t\t\tthis.last_type = c.communication_medium;\n\t\t\tthis.add_reply_btn_event($timeline_item, c);\n\t\t}\n\n\t}\n\n\tadd_reply_btn_event($timeline_item, c) {\n\t\tvar me = this;\n\t\t$timeline_item.find(\".reply-link\").on(\"click\", function() {\n\t\t\tvar name = $(this).attr(\"data-name\");\n\t\t\tvar last_email = null;\n\n\t\t\t// find the email tor reply to\n\t\t\tme.get_communications().forEach(function(c) {\n\t\t\t\tif(c.name==name) {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// make the composer\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\ttxt: \"\",\n\t\t\t\ttitle: __('Reply'),\n\t\t\t\tfrm: me.frm,\n\t\t\t\tlast_email: last_email,\n\t\t\t\tis_a_reply: true\n\t\t\t});\n\t\t});\n\t}\n\n\tprepare_timeline_item(c) {\n\t\tif(!c.sender) c.sender = c.owner || 'Guest';\n\n\t\tif(c.sender && c.sender.indexOf(\"<\")!==-1) {\n\t\t\tc.sender = c.sender.split(\"<\")[1].split(\">\")[0];\n\t\t}\n\n\t\tc.user_info = frappe.user_info(c.sender);\n\n\t\tc[\"delete\"] = \"\";\n\t\tc[\"edit\"] = \"\";\n\t\tif(c.communication_type==\"Comment\" && (c.comment_type || \"Comment\") === \"Comment\") {\n\t\t\tif(frappe.model.can_delete(\"Communication\")) {\n\t\t\t\tc[\"delete\"] = `<a class=\"close delete-comment\" title=\"${__('Delete')}\"  href=\"#\"><i class=\"octicon octicon-x\"></i></a>`;\n\t\t\t}\n\n\t\t\tif(frappe.user.name == c.sender || (frappe.user.name == 'Administrator')) {\n\t\t\t\tc[\"edit\"] = `<a class=\"edit-comment text-muted\" title=\"${__('Edit')}\" href=\"#\">${__('Edit')}</a>`;\n\t\t\t}\n\t\t}\n\t\tlet communication_date = c.communication_date || c.creation;\n\t\tc.comment_on_small = comment_when(communication_date, true);\n\t\tc.comment_on = comment_when(communication_date);\n\t\tc.futur_date = communication_date > frappe.datetime.now_datetime() ? true : false;\n\t\tif(!c.fullname) {\n\t\t\tc.fullname = c.sender_full_name || frappe.user.full_name(c.sender);\n\t\t}\n\n\t\tif(c.attachments && typeof c.attachments===\"string\")\n\t\t\tc.attachments = JSON.parse(c.attachments);\n\n\t\tif(c.communication_type==\"Comment\" && !c.comment_type) {\n\t\t\tc.comment_type = \"Comment\";\n\t\t}\n\n\t\tthis.set_icon_and_color(c);\n\n\t\t// label view\n\t\tif(c.comment_type===\"Workflow\" || c.comment_type===\"Label\") {\n\t\t\tc.comment_html = repl('<span class=\"label label-%(style)s\">%(text)s</span>', {\n\t\t\t\tstyle: frappe.utils.guess_style(c.content),\n\t\t\t\ttext: __(c.content)\n\t\t\t});\n\t\t} else {\n\t\t\tif(c.communication_type==\"Communication\" && c.communication_medium==\"Email\") {\n\t\t\t\tc.content = c.content.split(frappe.separator_element)[0];\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t} else if (c.communication_type===\"Feedback\") {\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t}\n\t\t\tif(!frappe.utils.is_html(c.content)) {\n\t\t\t\tc.content_html = frappe.markdown(__(c.content));\n\t\t\t} else {\n\t\t\t\tc.content_html = c.content;\n\t\t\t\tc.content_html = frappe.utils.strip_whitespace(c.content_html);\n\t\t\t}\n\n\t\t\t// bold @mentions\n\t\t\tif(c.comment_type===\"Comment\" &&\n\t\t\t\t// avoid adding <b> tag a 2nd time\n\t\t\t\t!c.content_html.match(/(^|\\W)<b>(@[^\\s]+)<\\/b>/)\n\t\t\t) {\n\t\t\t\t/*\n\t\t\t\t\tReplace the email ids by only displaying the string which\n\t\t\t\t\toccurs before the second `@` to enhance the mentions.\n\t\t\t\t\tEg.\n\t\t\t\t\t@abc@a-example.com will be converted to\n\t\t\t\t\t@abc with the below line of code.\n\t\t\t\t*/\n\n\t\t\t\t// bold the @mentions\n\t\t\t\tc.content_html = c.content_html.replace(/(@[^\\s@]*)@[^\\s@|<]*/g, \"<b>$1</b>\");\n\t\t\t}\n\n\t\t\tif (this.is_communication_or_comment(c)) {\n\t\t\t\tc.user_content = true;\n\t\t\t\tif (!$.isArray(c._liked_by)) {\n\t\t\t\t\tc._liked_by = JSON.parse(c._liked_by || \"[]\");\n\t\t\t\t}\n\n\t\t\t\tc.liked_by_user = c._liked_by.indexOf(frappe.session.user)!==-1;\n\t\t\t}\n\t\t}\n\n\t\t// basic level of XSS protection\n\t\tc.content_html = frappe.dom.remove_script_and_style(c.content_html);\n\n\t\t// subject\n\t\tc.show_subject = false;\n\t\tif(c.subject && c.communication_type===\"Communication\") {\n\t\t\tif(this.frm.doc.subject && !this.frm.doc.subject.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(this.frm.meta.title_field && this.frm.doc[this.frm.meta.title_field]\n\t\t\t\t&& !!this.frm.doc[this.frm.meta.title_field].includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(!this.frm.doc.name.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tis_communication_or_comment(c) {\n\t\treturn c.communication_type===\"Communication\"\n\t\t|| c.communication_type===\"Feedback\"\n\t\t|| (c.communication_type===\"Comment\" && (c.comment_type===\"Comment\"||c.comment_type===\"Relinked\"));\n\t}\n\n\tset_icon_and_color(c) {\n\t\tif(c.communication_type == \"Feedback\"){\n\t\t\tc.icon = \"octicon octicon-comment-discussion\"\n\t\t\tc.rating_icons = frappe.render_template(\"rating_icons\", {rating: c.rating, show_label: true})\n\t\t\tc.color = \"#f39c12\"\n\t\t} else {\n\t\t\tc.icon = {\n\t\t\t\t\"Email\": \"octicon octicon-mail\",\n\t\t\t\t\"Chat\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Phone\": \"octicon octicon-device-mobile\",\n\t\t\t\t\"SMS\": \"octicon octicon-comment\",\n\t\t\t\t\"Event\": \"fa fa-calendar\",\n\t\t\t\t\"Meeting\": \"octicon octicon-briefcase\",\n\t\t\t\t\"ToDo\": \"fa fa-check\",\n\t\t\t\t\"Created\": \"octicon octicon-plus\",\n\t\t\t\t\"Submitted\": \"octicon octicon-lock\",\n\t\t\t\t\"Cancelled\": \"octicon octicon-x\",\n\t\t\t\t\"Assigned\": \"octicon octicon-person\",\n\t\t\t\t\"Assignment Completed\": \"octicon octicon-check\",\n\t\t\t\t\"Comment\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Workflow\": \"octicon octicon-git-branch\",\n\t\t\t\t\"Label\": \"octicon octicon-tag\",\n\t\t\t\t\"Attachment\": \"octicon octicon-cloud-upload\",\n\t\t\t\t\"Attachment Removed\": \"octicon octicon-trashcan\",\n\t\t\t\t\"Shared\": \"octicon octicon-eye\",\n\t\t\t\t\"Unshared\": \"octicon octicon-circle-slash\",\n\t\t\t\t\"Like\": \"octicon octicon-heart\",\n\t\t\t\t\"Edit\": \"octicon octicon-pencil\",\n\t\t\t\t\"Relinked\": \"octicon octicon-check\",\n\t\t\t\t\"Reply\": \"octicon octicon-mail-reply\"\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t\tc.color = {\n\t\t\t\t\"Email\": \"#3498db\",\n\t\t\t\t\"Chat\": \"#3498db\",\n\t\t\t\t\"Phone\": \"#3498db\",\n\t\t\t\t\"SMS\": \"#3498db\",\n\t\t\t\t\"Created\": \"#1abc9c\",\n\t\t\t\t\"Submitted\": \"#1abc9c\",\n\t\t\t\t\"Cancelled\": \"#c0392b\",\n\t\t\t\t\"Assigned\": \"#f39c12\",\n\t\t\t\t\"Assignment Completed\": \"#16a085\",\n\t\t\t\t\"Comment\": \"#f39c12\",\n\t\t\t\t\"Workflow\": \"#2c3e50\",\n\t\t\t\t\"Label\": \"#2c3e50\",\n\t\t\t\t\"Attachment\": \"#7f8c8d\",\n\t\t\t\t\"Attachment Removed\": \"#eee\",\n\t\t\t\t\"Relinked\": \"#16a085\",\n\t\t\t\t\"Reply\": \"#8d99a6\"\n\t\t\t}[c.comment_type || c.communication_medium];\n\n\t\t\tc.icon_fg = {\n\t\t\t\t\"Attachment Removed\": \"#333\",\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t}\n\t\tif(!c.icon_fg)\n\t\t\tc.icon_fg = \"#fff\";\n\t}\n\n\tget_communications(with_versions) {\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [].concat(docinfo.communications);\n\t\tif(with_versions) {\n\t\t\tthis.build_version_comments(docinfo, out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tget_view_logs(){\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [];\n\t\tfor(let c of docinfo.views){\n\t\t\tc.content = `<a href=\"#Form/View Log/${c.name}\"> ${__(\"viewed\")}</a>`;\n\t\t\tc.comment_type = \"Info\";\n\t\t\tout.push(c);\n\t\t};\n\t\treturn out;\n\t}\n\n\tbuild_version_comments(docinfo, out) {\n\t\tvar me = this;\n\t\tdocinfo.versions.forEach(function(version) {\n\t\t\tif(!version.data) return;\n\t\t\tvar data = JSON.parse(version.data);\n\n\t\t\t// comment\n\t\t\tif(data.comment) {\n\t\t\t\tout.push(me.get_version_comment(version, data.comment, data.comment_type));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// value changed in parent\n\t\t\tif(data.changed && data.changed.length) {\n\t\t\t\tvar parts = [];\n\t\t\t\tdata.changed.every(function(p) {\n\t\t\t\t\tif(p[0]==='docstatus') {\n\t\t\t\t\t\tif(p[2]==1) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('submitted this document')));\n\t\t\t\t\t\t} else if (p[2]==2) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('cancelled this document')));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold()\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed value of {0}\", [parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// value changed in table field\n\t\t\tif(data.row_changed && data.row_changed.length) {\n\t\t\t\tvar parts = [], count = 0;\n\t\t\t\tdata.row_changed.every(function(row) {\n\t\t\t\t\trow[3].every(function(p) {\n\t\t\t\t\t\tvar df = me.frm.fields_dict[row[0]] &&\n\t\t\t\t\t\t\tfrappe.meta.get_docfield(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\t\t\tnull, me.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\t\t\tfrappe.meta.get_label(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t\t});\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed values for {0}\",\n\t\t\t\t\t\t[parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rows added / removed\n\t\t\t// __('added'), __('removed') # for translation, don't remove\n\t\t\t['added', 'removed'].forEach(function(key) {\n\t\t\t\tif(data[key] && data[key].length) {\n\t\t\t\t\tparts = (data[key] || []).map(function(p) {\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\treturn frappe.meta.get_label(me.frm.doctype, p[0])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tparts = parts.filter(function(p) { return p; });\n\t\t\t\t\tif(parts.length) {\n\t\t\t\t\t\tout.push(me.get_version_comment(version, __(\"{0} rows for {1}\",\n\t\t\t\t\t\t\t[__(key), parts.join(', ')])));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_version_comment(version, text, comment_type) {\n\t\tif(!comment_type) {\n\t\t\ttext = '<a href=\"#Form/Version/'+version.name+'\">' + text + '</a>';\n\t\t}\n\t\treturn {\n\t\t\tcomment_type: comment_type || 'Edit',\n\t\t\tcreation: version.creation,\n\t\t\towner: version.owner,\n\t\t\tversion_name: version.name,\n\t\t\tsender: version.owner,\n\t\t\tcomment_by: version.owner,\n\t\t\tcontent: text\n\t\t};\n\t}\n\n\tinsert_comment(comment_type, comment, btn) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.add_comment\",\n\t\t\targs: {\n\t\t\t\tdoc:{\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tcommunication_type: \"Comment\",\n\t\t\t\t\tcomment_type: comment_type || \"Comment\",\n\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\tcontent: comment,\n\t\t\t\t\tsender: frappe.session.user\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tme.comment_area.set_value('');\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\n\t\t\t\t\tvar comment = r.message;\n\t\t\t\t\tvar comments = me.get_communications();\n\t\t\t\t\tvar comment_exists = false;\n\t\t\t\t\tfor (var i=0, l=comments.length; i<l; i++) {\n\t\t\t\t\t\tif (comments[i].name==comment.name) {\n\t\t\t\t\t\t\tcomment_exists = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (comment_exists) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.frm.get_docinfo().communications = comments.concat([r.message]);\n\t\t\t\t\tme.refresh(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tdelete_comment(name) {\n\t\tvar me = this;\n\n\t\tfrappe.confirm(__('Delete comment?'), function() {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.client.delete\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tname: name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\n\t\t\t\t\t\tme.frm.get_docinfo().communications =\n\t\t\t\t\t\t\t$.map(me.frm.get_docinfo().communications,\n\t\t\t\t\t\t\t\tfunction(v) {\n\t\t\t\t\t\t\t\t\tif(v.name==name) return null;\n\t\t\t\t\t\t\t\t\telse return v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tme.refresh(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Update comment\n\t *\n\t * @param {string} name\n\t * @param {string} content\n\t *\n\t * @returns {boolean}\n\t */\n\tupdate_comment(name, content){\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.update_comment',\n\t\t\targs: { name, content },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tget_last_email(from_recipient) {\n\t\tvar last_email = null,\n\t\t\tcommunications = this.frm.get_docinfo().communications,\n\t\t\temail = this.get_recipient();\n\n\t\t$.each(communications && communications.sort(function(a, b) { return a.creation > b.creation ? -1 : 1 }), function(i, c) {\n\t\t\tif(c.communication_type=='Communication' && c.communication_medium==\"Email\") {\n\t\t\t\tif(from_recipient) {\n\t\t\t\t\tif(c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn last_email;\n\t}\n\n\tget_names_for_mentions() {\n\t\tvar valid_users = Object.keys(frappe.boot.user_info)\n\t\t\t.filter(user => ![\"Administrator\", \"Guest\"].includes(user));\n\n\t\treturn valid_users.map(user => frappe.boot.user_info[user].name);\n\t}\n\n\tsetup_comment_like() {\n\t\tthis.wrapper.on(\"click\", \".comment-likes .octicon-heart\", frappe.ui.click_toggle_like);\n\n\t\tfrappe.ui.setup_like_popover(this.wrapper, \".comment-likes\");\n\t}\n};\n\n$.extend(frappe.timeline, {\n\tnew_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\t\t\tvar communication_exists = false;\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tcommunication_exists = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!communication_exists) {\n\t\t\t\tdocinfo.communications = communications.concat([communication]);\n\t\t\t}\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tdelete_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\t\tif (index !== -1) {\n\t\t\t// remove it from communications list\n\t\t\tdocinfo.communications.splice(index, 1);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tupdate_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\n\t\tif (index !== -1) {\n\t\t\t// update\n\t\t\t$.extend(docinfo.communications[index], communication);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tindex_of_communication: function(communication, docinfo) {\n\t\tvar index = -1;\n\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.AssignTo = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment\").on(\"click\", function() { me.add(); });\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t},\n\trender: function(d) {\n\t\tvar me = this;\n\t\tthis.frm.get_docinfo().assignments = d;\n\t\tthis.parent.find(\".assignment-row\").remove();\n\n\t\tif(me.primary_action) {\n\t\t\tme.primary_action.remove();\n\t\t\tme.primary_action = null;\n\t\t}\n\n\t\tif(this.dialog) {\n\t\t\tthis.dialog.hide();\n\t\t}\n\n\t\tif(d && d.length) {\n\t\t\tfor(var i=0; i<d.length; i++) {\n\t\t\t\tvar info = frappe.user_info(d[i].owner);\n\t\t\t\tinfo.assign_to_name = d[i].name\n\t\t\t\tinfo.owner = d[i].owner;\n\t\t\t\tinfo.avatar = frappe.avatar(d[i].owner);\n\t\t\t\tinfo.description = d[i].description || \"\";\n\n\t\t\t\tinfo._fullname = info.fullname;\n\t\t\t\tif(info.fullname.length > 10) {\n\t\t\t\t\tinfo._fullname = info.fullname.substr(0, 10) + '...';\n\t\t\t\t}\n\n\t\t\t\t$(repl('<li class=\"assignment-row\">\\\n\t\t\t\t\t<a class=\"close\" data-owner=\"%(owner)s\">&times;</a>\\\n\t\t\t\t\t%(avatar)s\\\n\t\t\t\t\t<span><a href=\"#Form/ToDo/%(assign_to_name)s\">%(_fullname)s</a></span>\\\n\t\t\t\t</li>', info))\n\t\t\t\t\t.insertBefore(this.parent.find('.add-assignment'));\n\n\t\t\t\tif(d[i].owner===frappe.session.user) {\n\t\t\t\t\tme.primary_action = this.frm.page.add_menu_item(__(\"Assignment Complete\"), function() {\n\t\t\t\t\t\tme.remove(frappe.session.user);\n\t\t\t\t\t}, \"fa fa-check\", \"btn-success\")\n\t\t\t\t}\n\n\t\t\t\tif(!(d[i].owner === frappe.session.user || me.frm.perm[0].write)) {\n\t\t\t\t\tme.parent.find('a.close').remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set remove\n\t\t\tthis.parent.find('a.close').click(function() {\n\t\t\t\tme.remove($(this).attr('data-owner'));\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t//this.btn_wrapper.addClass(\"hide\");\n\t\t} else {\n\t\t\t//this.btn_wrapper.removeClass(\"hide\");\n\t\t}\n\t},\n\tadd: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif(!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: me,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add',\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\n\t\tif(me.frm.meta.title_field) {\n\t\t\tme.assign_to.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field])\n\t\t}\n\n\t\tme.assign_to.dialog.show();\n\t\tme.assign_to = null;\n\t},\n\tremove: function(owner) {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.desk.form.assign_to.remove',\n\t\t\targs: {\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tname: me.frm.docname,\n\t\t\t\tassign_to: owner\n\t\t\t},\n\t\t\tcallback:function(r,rt) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.AssignToDialog = Class.extend({\n\tinit: function(opts){\n\t\tvar me = this\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to To Do'),\n\t\t\tfields: [\n\t\t\t\t{ fieldtype: 'Link', fieldname: 'assign_to', options: 'User', label: __(\"Assign To\"), reqd: true, filters: { 'user_type': 'System User' }},\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'myself', label: __(\"Assign to me\"), \"default\": 0 },\n\t\t\t\t{ fieldtype: 'Small Text', fieldname: 'description', label: __(\"Comment\") },\n\t\t\t\t{ fieldtype: 'Section Break' },\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Date', fieldname: 'date', label: __(\"Complete By\") },\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'notify', label: __(\"Notify by Email\"), default: 1},\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Select', fieldname: 'priority', label: __(\"Priority\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ value: 'Low', label: __('Low') },\n\t\t\t\t\t\t{ value: 'Medium', label: __('Medium') },\n\t\t\t\t\t\t{ value: 'High', label: __('High') }\n\t\t\t\t\t],\n\t\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\t\t'default': [\"Low\", \"Medium\", \"High\"].includes(opts.obj.frm && opts.obj.frm.doc.priority\n\t\t\t\t\t\t? opts.obj.frm.doc.priority : 'Medium')\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: function() { frappe.ui.add_assignment(opts, this) },\n\t\t\tprimary_action_label: __(\"Add\")\n\t\t})\n\t\t$.extend(me, dialog);\n\n\t\tme.dialog = dialog;\n\n\t\tme.dialog.fields_dict.assign_to.get_query = \"frappe.core.doctype.user.user.user_query\";\n\n\t\tvar myself = me.dialog.get_input(\"myself\").on(\"click\", function() {\n\t\t\tme.toggle_myself(this);\n\t\t});\n\t\tme.toggle_myself(myself);\n\t},\n\ttoggle_myself: function(myself) {\n\t\tvar me = this;\n\t\tif($(myself).prop(\"checked\")) {\n\t\t\tme.dialog.set_value(\"assign_to\", frappe.session.user);\n\t\t\tme.dialog.set_value(\"notify\", 0);\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(false);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(false);\n\t\t} else {\n\t\t\tme.dialog.set_value(\"assign_to\", \"\");\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(true);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(true);\n\t\t}\n\t},\n\n});\n\nfrappe.ui.add_assignment = function(opts, dialog) {\n\tvar assign_to = dialog.fields_dict.assign_to.get_value();\n\tvar args = dialog.get_values();\n\tif(args && assign_to) {\n\t\treturn frappe.call({\n\t\t\tmethod: opts.method,\n\t\t\targs: $.extend(args, {\n\t\t\t\tdoctype: opts.doctype,\n\t\t\t\tname: opts.docname,\n\t\t\t\tassign_to: assign_to,\n\t\t\t\tbulk_assign:  opts.bulk_assign || false,\n\t\t\t\tre_assign: opts.re_assign || false\n\t\t\t}),\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(opts.callback){\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t\t}\n\t\t\t\t\tdialog && dialog.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: this\n\t\t});\n\t}\n}\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = Class.extend({\n\tinit: function(doctype, after_insert, init_callback, doc) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t},\n\n\tsetup: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, function() {\n\t\t\t\tme.set_meta_and_mandatory_fields();\n\t\t\t\tif(me.is_quick_entry()) {\n\t\t\t\t\tme.render_dialog();\n\t\t\t\t\tresolve(me);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', me.doctype, me.doc.name)\n\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_meta_and_mandatory_fields: function(){\n\t\tlet fields = frappe.get_meta(this.doctype).fields;\n\t\tif (fields.length < 7) {\n\t\t\t// if less than 7 fields, then show everything\n\t\t\tthis.mandatory = fields;\n\t\t} else {\n\t\t\t// prepare a list of mandatory and bold fields\n\t\t\tthis.mandatory = $.map(fields,\n\t\t\t\tfunction(d) { return ((d.reqd || d.bold || d.allow_in_quick_entry) && !d.read_only) ? $.extend({}, d) : null; });\n\t\t}\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t},\n\n\tis_quick_entry: function(){\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table()\n\t\t\t|| !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\ttoo_many_mandatory_fields: function(){\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\thas_child_table: function(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tvalidate_for_prompt_autoname: function(){\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t},\n\n\trender_dialog: function(){\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t});\n\t\tthis.dialog.doc = this.doc;\n\n\t\tthis.register_primary_action();\n\t\tthis.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t},\n\n\tregister_primary_action: function(){\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__('Saving...'));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tif (!me.skip_redirect_on_error) {\n\t\t\t\t\t\tme.open_doc();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_form_if_not_list: function() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t},\n\n\tupdate_doc: function(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif(key==='__newname') {\n\t\t\t\tme.dialog.doc.name = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t},\n\n\topen_doc: function(){\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t},\n\n\trender_edit_in_full_page_link: function(){\n\t\tvar me = this;\n\t\tvar $link = $('<div style=\"padding-left: 7px; padding-top: 30px; padding-bottom: 10px;\">' +\n\t\t\t'<button class=\"edit-full btn-default btn-sm\">' + __(\"Edit in full page\") + '</button></div>').appendTo(this.dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\tme.open_doc();\n\t\t});\n\t},\n\n\tset_defaults: function(){\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif(!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n});\n","frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.success_action');\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action\n\t\t\t.find(setting => setting.ref_doctype === this.form.doctype);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.form.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find('.success-container');\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.count(this.form.doctype)\n\t\t\t.then(count => {\n\t\t\t\tconst setting = this.setting;\n\t\t\t\tlet message = count === 1 ?\n\t\t\t\t\tsetting.first_success_message :\n\t\t\t\t\tsetting.message;\n\n\t\t\t\tconst $buttons = this.get_actions().map(action => {\n\t\t\t\t\tconst $btn = $(`<button class=\"next-action\"><span>${action.label}</span></button>`);\n\t\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\t\treturn $btn;\n\t\t\t\t});\n\n\t\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\t\tnext_action_container.append($buttons);\n\t\t\t\tconst html = next_action_container;\n\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: 'green',\n\t\t\t\t}, setting.action_timeout || 7);\n\t\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions\n\t\t\t.forEach(action => {\n\t\t\t\tif (typeof action === 'string' && this.default_actions[action]) {\n\t\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t\t} else if (typeof action === 'object') {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\t'new': {\n\t\t\t\tlabel: __('New'),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype)\n\t\t\t},\n\t\t\t'print': {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: (frm) => frm.print_doc()\n\t\t\t},\n\t\t\t'email': {\n\t\t\t\tlabel: __('Email'),\n\t\t\t\taction: (frm) => frm.email_doc()\n\t\t\t},\n\t\t\t'list': {\n\t\t\t\tlabel: __('View All'),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route('List', frm.doctype);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n};\n"],"names":["frappe","provide","views","FormFactory","Factory","[object Object]","route","me","this","dt","formview","show_doc","model","with_doctype","page","container","add_page","frm","_f","Frm","initialized","$","document","on","ui","form","close_grid_form","realtime","data","timeline","new_communication","delete_communication","update_communication","set_viewers","dn","slice","join","new_names","set_route","with_doc","r","locals","load","new_str","__","substr","length","new_name","make_new_doc_and_get_name","show_not_found","change_to","refresh","Controller","Class","extend","init","opts","frms","doctype","parent","in_form","docname","hidden","refresh_if_stale_for","opendocs","custom_buttons","sections","grids","cscript","events","pformat","fetch_dict","tinymce_id_list","setup_meta","event","old_name","rename_notify","prototype","check_doctype_conflict","msgprint","pages","window","location","reload","DocType","setup","fields","fields_dict","state_fieldname","workflow","get_state_fieldname","wrapper","$wrapper","make_app_page","single_column","meta","hide_toolbar","layout_main","main","get","toolbar","Toolbar","setup_print_layout","setup_std_layout","script_manager","ScriptManager","watch_model_updates","footer","Footer","appendTo","attr","setup_drag_drop","setup_done","e","dataTransfer","originalEvent","files","stopPropagation","preventDefault","doc","__islocal","attachments","max_reached","upload","make","args","get_args","callback","attachment","attachment_uploaded","print_preview","PrintPreview","set_primary_action","print_doc","is","hide_print","can_print","refresh_print_options","trigger","set_view","set_user_lang","set_default_print_language","preview","current_view_name","previous_view_name","fieldname","value","name","dirty","let","field","includes","df","fieldtype","validate","layout","refresh_dependency","table_fields","get_children","each","i","options","parentfield","grid","set_value","form_wrapper","body","section_style","Layout","with_dashboard","fields_list","document_flow","DocumentFlow","dashboard","Dashboard","states","States","email_doc","message","CommunicationComposer","subject","recipients","email","email_id","contact_email","attach_document_print","real_name","contact_display","contact_name","rename_doc","share_doc","shared","show","old","istable","docfield_copy","in_dialog","re_route","hash","encodeURIComponent","get_doc","perm","get_perm","refresh_header","is_a_different_doc","utils","set_title","issingle","current_status","undefined","is_submittable","submit","is_dirty","is_new","has_workflow","docstatus","add_comment","clear_custom_buttons","show_web_link","__onload","is_website_generator","web_link","remove","published","add_web_link","path","label","sidebar","add_user_action","check_doc_perm","parent_doctype","read","scroll_to","forEach","grid_obj","visible_columns","cur_frm","show_not_permitted","read_only","is_read_only","set_read_only","__unsaved","__last_sync_on","Date","reload_doc","is_onload","render_form","localname","setnewdoc","show_print_first","removeClass","toggleClass","show_if_needs_refresh","__needs_refresh","clear_headline","set_headline_alert","attach_doc_and_docfields","Sidebar","show_message","run_serially","refresh_fields","after_refresh","first","find","in_list","focus","show_empty_form_message","scroll_to_element","refresh_field","fname","primary_button","cleanup_refresh","amended_from","unhide_field","hide_field","trash_reason","autoname","fn","toggle_display","then","after_ajax","trigger_link_fields","breadcrumbs","add","module","track_seen","addClass","__run_link_triggers","runscript","scriptname","callingfield","onrefresh","input","set_working","call","method","docs","btn","$input","exc","copy_doc","onload","from_amend","validate_form_action","newdoc","idx","remove_from_locals","validated","Object","defineProperty","console","warn","set","save","save_action","on_error","Promise","resolve","reject","prop","activeElement","blur","setTimeout","_save","show_success_action","catch","error","after_save","indexOf","play_sound","comment_area","fail","savesubmit","handle_fail","confirm","savecancel","savetrash","delete_doc","history","back","amend_doc","amendment_date","datetime","obj_to_str","alert","disable_save","save_disabled","clear_primary_action","enable_save","save_or_update","get_docinfo","docinfo","reload_docinfo","assign_to","permlevel","access_type","set_intro","txt","set_footnote","footnote_area","add_custom_button","group","add_inner_button","clear_inner_toolbar","clear_user_actions","remove_custom_button","remove_inner_button","add_fetch","link_field","src_field","tar_field","columns","push","set_print_heading","action_perm_type_map","Create","Save","Submit","Update","Cancel","Amend","Delete","action","perm_to_check","allowed_for_workflow","perms","throw","has_perm","ptype","route_options","selector","key","repl","get_route","SuccessAction","is_first_creation","modified","split","creation","get_server_fields","arg","table_field","allow_edit","call_back","dom","freeze","isPlainObject","JSON","stringify","$c","unfreeze","d","field_dict","set_multiple","dict","refresh_many","flist","set_field_tip","n","get_docfield","description","innerHTML","replace_newlines","log","filter_dict","docfields","grid_rows_by_docname","set_field_options","set_df_property","set_field_permlevel","level","toggle_field","get_field_obj","set_currency_labels","currency","field_label_map","grid_field_label_map","docfield","docfield_map","replace","trim","set_label","field_map","fnames","keys","l","fieldname1","fieldname2","property","toggle_enable","enable","toggle_reqd","mandatory","reqd","call_server","$c_obj","get_files","sort","get_attachments","set_query","opt1","opt2","get_field","get_query","set_value_if_missing","clear_table","add_child","values","unique_keys","map","if_missing","_set","f","v","fieldobj","has_value","isArray","j","child","tasks","original_callback","get_server_module_name","std_field_list","concat","std_fields_list","docperms","print","cancel","get_formatted","format","no_icon","open_grid_row","get_open_grid_form","get_title","title_field","get_selected","selected","get_table_fields","_selected","has_mapper","_has_mapper","__js","search","set_indicator_formatter","get_color","get_text","every","formatter","link_formatters","const","escaped_name","color","can_create","custom_make_buttons","can_make_methods","make_new","make_methods","new_doc","get_new_doc","get_meta","make_quick_entry","update_in_all_rows","table_fieldname","cl","get_sum","sum","add_update_button_on_dirty","setup_editable_title","make_menu","show_title_as_dirty","hide_menu","print_icon","show_menu","toString","title","strip_html","set_title_sub","$title_area","is_title_editable","can_rename","set_indicator","write","allow_rename","prompt","default","get_dropdown_menu","add_dropdown","indicator","get_indicator","clear_indicator","clear_icons","clear_menu","p","cint","print_settings","allow_print_for_draft","allow_print_for_cancelled","add_menu_item","add_action_icon","can_email","show_linked_with","boot","user","allow_copy","add_to_desktop","can_delete","user_roles","custom","doc_type","developer_mode","Feedback","manual_feedback_request","CREATE","can_save","get_docstatus","can_submit","can_update","can_cancel","can_amend","amend","_has_workflow","get_list","document_type","linked_with","LinkedWith","status","get_action_status","xcall","is_amended","set_page_actions","clear_actions","set_secondary_action","click","icon","clear_actions_menu","section","_form_dashboard","render_template","progress_area","heatmap_area","chart_area","stats_area","stats_area_row","links_area","transactions_area","reset","empty","set_headline","html","text","alert_class","permanent","clear_comment","indicator_color","add_section","add_progress","percent","progress_chart","make_progress_chart","format_percent","progress","show_progress","_progress_map","progress_bar","css","width","progress_class","hide_progress","init_data","transactions","render_links","set_open_count","heatmap","render_heatmap","graph","setup_graph","__dashboard","internal_links","filter_permissions","add_transactions","group_added","Array","items","ref","can_read","data_rendered","open_document_list","$link","show_open","names","get_document_filter","notifications","show_open_count_list","filter","non_standard_fieldnames","dynamic_links","item","type","timeline_data","update_heatmap","count","set_badge_count","open_count","link","link_fieldname","dashboard_data","update","Chart","scrub","height","start","moment","subtract","toDate","count_label","discreteDomains","margin","heatmap_message","add_indicator","colspan","indicators","n_indicators","graph_method","graph_method_args","render_graph","colors","chart","hide","doctypes","prependTo","render","get_linked_docs","mark_completed_flow","for_doctype","frm_doctype","frm_docname","workflow_state_fieldname","working_label","toTitle","freeze_message","remove_empty_rows","get_all_docs","is_table","cells","is_empty_row","docfield_list","in_list_view","clear_doc","check_mandatory","has_errors","scroll_set","error_fields","folded","unfold","parenttype","bold","scrollTop","offset","top","_call","is_saving","remove_old_form_route","always","update_calling_link","workflow_state","current_route","route_history","_from_link","grid_rows","index","_from_link_scrollY","get_event_handler_list","handlers","on_change","handler","add_handler","off","ControllerClass","event_name","get_handlers","selected_doc","runner","_function","is_old_style","_promise","after_server_call","new_style","old_style","has_handlers","cs","tmp","eval","__custom_js","stack","setup_add_fetch","fetch_from","parts","get_docfields","__css","set_style","log_error","caller","show_alert","trace","groupEnd","copy_from_first_row","current_row","fieldnames","dialog","make_dialog","Dialog","hide_on_page_refresh","on_page_show","get_linked_doctypes","load_doctypes","links_not_permitted_or_missing","make_html","linked_docs","__linked_docs","linked_doctypes","make_doc_head","make_doc_row","already_loaded","doctypes_to_load","__linked_doctypes","promises","listview_settings","add_fields","all","flag","links","can_get_report","linkinfo","heading","update_fields","get_update_fields","bind","setup_help","add_action_item","state","get_state","workflows","get_transitions","transitions","next_html","allowed","get_document_state","padding","set_default_state","show_actions","added","transition","approval_access","session","allow_self_approval","owner","sync","setup_btn","action_added","btn_primary","btn_secondary","default_state","get_default_state","bind_events","add_view","toggle","has_role","which","target","print_formats","get_print_formats","print_letterhead","print_sel","with_letterhead","multilingual_preview","language_sel","lang_code","val","print_old_style","printit","new_page_preview_old_style","new_page_preview","open","urllib","get_full_url","selected_format","print_format","get_print_format","is_custom_format","print_format_builder","standard","custom_format","print_format_name","based_on","language","add_options","get_languages","default_print_language","lang","preview_old_style","get_print_html","out","$print_format","show_footer","style","print_height","offsetHeight","$message","pixel_to_inches","display","flexDirection","flex-direction","flex","no_letterhead","_req","abort","_lang","with_old_style","only_body","no_heading","require","_p","build","go","default_print_format","print_format_type","print_css","get_print_settings","pdf","letter_head","default_letter_head","defaults","get_default","depends_on","letter_heads","with_letter_head","sidebar_content","ratings","comments","user_actions","image_section","image_wrapper","make_assignments","make_attachments","make_shared","make_viewers","make_tags","make_like","setup_user_image_event","like_icon","toggle_like","refresh_like","viewers","tags","_user_tags","full_name","modified_by","comment_when","setup_ratings","set_user_image","refresh_comments","get_communications","c","communication_type","comment_type","total_comments","TagEditor","user_tags","Attachments","AssignTo","Share","Viewers","like_wrapper","like_count","setup_like_popover","_liked_by","is_liked","parse","refresh_image","_ratings","rating","rating_icons","show_label","image_field","image","title_image","cordova","base_url","background-color","get_palette","get_abbr","make_input","render_sidebar","users","s","everyone","avatar_class","user_info","fullname","abbr","append","render_shared","onhide","can_share","make_user_input","add_share_button","set_edit_share_events","share_with","make_control","filters","user_type","only_input","render_input","get_value","share","notify","parents","permission_to","found","get_viewers","data_updated","new_users","current","username","new","comma_and","past_viewers","past","new_viewers","viewer","set_docinfo","make_comments","Timeline","new_attachment","add_attachment_wrapper","attachments_label","max_attachments","add_attachment","file_name","file_url","get_file_url","fileid","$close","file_path","is_private","insertAfter","remove_btn","remove_attachment","can_write","encodeURI","get_file_id_from_file_url","fid","remove_attachment_by_filename","filename","rt","_server_messages","remove_fileid","communications","get_upload_dialog","max_width","attachment_max_width","max_height","attachment_max_height","from_form","update_attachment","comment","add_to_attachments","form_attachments","new_attachments","no_focus","onchange","gsuite_enabled","related_doctype","gs_template","upload_area","on_select","onerror","separator_element","allow_events_in_timeline","list","mentions","get_names_for_mentions","on_submit","insert_comment","button","setup_email_button","setup_interaction_button","siblings","setup_comment_like","new_communications","more","email_button","is_a_reply","get_recipient","last_email","sender","comment_value","markdown","activity_button","InteractionComposer","$editing_area","editing_area","CommentArea","no_wrapper","destroy","scroll_to_end","last_type","get_view_logs","a","content","b","compare_dates","render_timeline_item","communication_date","change","b_date","c_date","prepare_timeline_item","$timeline_item","delete_comment","hasClass","current_editing_area","$edit_btn","$timeline_content","$timeline_edit","make_editing_area","update_comment","communication_medium","add_reply_btn_event","comment_on_small","comment_on","futur_date","now_datetime","sender_full_name","set_icon_and_color","comment_html","guess_style","strip_original_content","original_content","toggle_blockquote","is_html","content_html","strip_whitespace","match","is_communication_or_comment","user_content","liked_by_user","remove_script_and_style","show_subject","Email","Chat","Phone","SMS","Event","Meeting","ToDo","Created","Submitted","Cancelled","Assigned","Assignment Completed","Comment","Workflow","Label","Attachment","Attachment Removed","Shared","Unshared","Like","Edit","Relinked","Reply","icon_fg","with_versions","build_version_comments","versions","version","get_version_comment","changed","field_display_status","get_field_display_status","ellipsis","row_changed","row","get_label","version_name","comment_by","reference_doctype","reference_name","comment_exists","email_field","from_recipient","click_toggle_like","communication","communication_exists","index_of_communication","splice","btn_wrapper","assignments","primary_action","info","assign_to_name","avatar","_fullname","insertBefore","AssignToDialog","obj","clear","priority","add_assignment","primary_action_label","myself","get_input","toggle_myself","get_values","bulk_assign","re_assign","after_insert","init_callback","trimmed_doctype","controller_name","quick_entry","QuickEntryForm","set_meta_and_mandatory_fields","is_quick_entry","render_dialog","allow_in_quick_entry","validate_for_prompt_autoname","has_child_table","too_many_mandatory_fields","toLowerCase","register_primary_action","render_edit_in_full_page_link","keydown","ctrlKey","metaKey","request","ajax_count","get_primary_btn","set_defaults","working","set_message","insert","clear_message","update_doc","open_form_if_not_list","skip_redirect_on_error","open_doc","is_null","set_input","load_setting","setting","success_action","ref_doctype","prepare_dom","db","first_success_message","$buttons","get_actions","$btn","next_action_container","action_timeout","actions","next_actions","default_actions"],"mappings":"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"}